<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta
      name="google-site-verification"
      content="Y0kjf7mImXV2yFOMYnVNcZ9hZ8YAluEf_EdReKN-xYo"
    />
    <meta
      name="description"
      content="Practice Assam CEE mock tests with real exam pattern, instant results, and detailed analysis. Prepare smarter with PROYAX CEE."
    />
    <meta
      name="keywords"
      content="Assam CEE Online Mock Test 2026, Online Assam CEE Practice Test 2026, online Assam CEE preparation test paper 2026, Assam CEE online test package 2026, Assam CEE question paper, Assam CEE questions test paper, Assam CEE  mock test series, Assam CEE online test paper, Assam CEE practice paper, Assam CEE Online Mock Test 2026, Online Assam CEE Practice Test 2026, Assam CEE online test package 2026, Assam CEE online test series, Assam CEE online test, Assam CEE exam, Assam CEE 2026, Assam CEE exam 2026, Assam CEE test, Assam CEE online exam, Assam CEE online, Assam CEE entrance exam 2026, Indian Navy Matric Recruit, Assam CEE test, Assam CEE exam 2026, Assam CEE 2026, Assam CEE exam, Assam CEE 2026, Assam CEE exam, Assam CEE Online Mock Test 2026, Online Assam CEE Practice Test 2026, online Assam CEE preparation test paper 2026, Assam CEE online test package 2026, Assam CEE Online Mock Test 2026, Online Assam CEE Practice Test 2026 , online Assam CEE  preparation test paper 2026, Assam CEE online test package, Assam Combined Entrance Examination Online Mock Test 2026, Online Assam Combined Entrance Examination Practice Test 2026, online Assam Combined Entrance Examination preparation test paper 2026, Assam Combined Entrance Examination online test package 2026, Assam Combined Entrance Examination question paper, Assam Combined Entrance Examination questions test paper, Assam Combined Entrance Examination  mock test series, Assam Combined Entrance Examination online test paper, Assam Combined Entrance Examination practice paper, Assam Combined Entrance Examination Online Mock Test 2026"
    />
    <title>
      PROYAX - Assam CEE Mock Test Series 2026 | Free Online Practice
    </title>
    <link rel="icon" href="favicon.png?v=2" type="image/png" />
    <link rel="apple-touch-icon" href="favicon.png?v=2" />
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="favicon.png" />
    <link rel="stylesheet" href="styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,800;1,700&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      :root {
        --accent-dark: #ff9a3d;
        --muted: #cbd5e1;
        --panel: #fffaf6;
        --side-w: 240px;
        --logo: 30px;
        --gpad: 6px;
        --card-r: 6px;
        --qbtn: 26px;
        --qgap: 4px;
        --fs-sm: 11px;
        --fs-md: 13px;
        --fs-lg: 14px;
      }

      html,
      body {
        height: 100vh;
        margin: 0;
        padding: 0;
        overflow: hidden;
        font-family:
          Inter,
          system-ui,
          -apple-system,
          "Segoe UI",
          Roboto,
          Arial;
        font-size: 13px;
      }

      * {
        box-sizing: border-box;
      }

      .app {
        height: 100vh;
        display: flex;
        gap: 8px;
        padding: 8px;
        background: linear-gradient(180deg, #0a0e27, #0f1535, #141a2e);
        align-items: stretch;
      }

      .main {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 6px;
        height: 100%;
        min-width: 0;
      }

      .side {
        width: 30%;
        background: linear-gradient(180deg, #1a1f3a, #161b2e, #111827);
        padding: 16px;
        border-radius: 12px;
        border: 1px solid rgba(255, 154, 61, 0.15);
        display: flex;
        flex-direction: column;
        height: 100%;
        box-shadow:
          0 20px 60px rgba(0, 0, 0, 0.3),
          inset 0 1px 1px rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
      }

      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        padding: 12px 16px;
        background: linear-gradient(90deg, #1a1f3a, #161b2e, #0f1535);
        border-radius: 12px;
        border: 1px solid rgba(255, 154, 61, 0.1);
        box-shadow:
          0 10px 40px rgba(0, 0, 0, 0.4),
          inset 0 1px 1px rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(10px);
      }

      /* SIDE TOP CONTROLS */
      .side-top {
        display: flex;
        flex-direction: column;
        gap: 8px;
        align-items: stretch;
        padding: 8px 6px;
        margin-bottom: 12px;
      }

      .side-top .row1 {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
      }

      .side-top .row2 {
        display: flex;
        gap: 8px;
        justify-content: center;
        align-items: center;
        margin-top: 6px;
      }

      .control-btn {
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.03);
        background: rgba(255, 255, 255, 0.02);
        color: #cbd5e1;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-weight: 800;
      }

      #fullscreen-btn {
        position: relative;
        padding: 8px;
        border-radius: 10px;
        border: 2px solid rgba(255, 154, 61, 0.12);
        box-shadow: none;
        transition: all 0.25s ease;
        background: linear-gradient(
          90deg,
          rgba(255, 154, 61, 0.06),
          rgba(255, 154, 61, 0.02)
        );
      }

      #fullscreen-btn.fullscreen-active {
        box-shadow:
          0 0 0 6px rgba(255, 154, 61, 0.08),
          0 10px 30px rgba(255, 154, 61, 0.12);
        border-color: rgba(255, 154, 61, 0.6);
        animation: pulse 1.6s infinite;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.02);
        }
        100% {
          transform: scale(1);
        }
      }

      .start-locked {
        opacity: 0.45;
        pointer-events: none;
        filter: grayscale(20%);
      }
      .start-locked .lock-icon {
        display: inline-block;
        margin-left: 6px;
      }
      .lock-icon {
        display: none;
        color: #fff;
        opacity: 0.95;
        font-size: 12px;
      }

      .brand {
        display: flex;
        gap: 12px;
        align-items: center;
      }

      .brand img {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(255, 154, 61, 0.2);
      }

      .title {
        font-family: "Playfair Display", serif;
        font-size: 22px;
        font-weight: 800;
        letter-spacing: 0.8px;
        color: #fff;
        line-height: 1.2;
      }

      .subtitle {
        font-size: var(--fs-sm);
        color: #cbd5e1;
      }

      .meta {
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .timer {
        padding: 6px 12px;
        border-radius: 8px;
        background: linear-gradient(135deg, #ff9a3d, #ffb84d);
        border: 1px solid rgba(255, 154, 61, 0.3);
        font-weight: 800;
        font-size: 12px;
        color: #fff;
        box-shadow: 0 6px 20px rgba(255, 154, 61, 0.25);
      }

      .question-card {
        flex: 1;
        background: #fff;
        background: linear-gradient(180deg, #ffffff, #fffaf7);
        padding: 16px;
        border-radius: 12px;
        overflow: auto;
        border: 1px solid rgba(250, 230, 210, 0.8);
        box-shadow: 0 8px 20px rgba(15, 23, 42, 0.03);
        display: flex;
        flex-direction: column;
        min-width: 0;
      }

      .question-top {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 6px;
      }

      .qno {
        font-weight: 800;
        font-size: 14px;
        color: #0f172a;
      }

      .meta-sm {
        font-size: var(--fs-sm);
        color: #6b7280;
      }

      .question {
        margin-top: 8px;
        font-size: var(--fs-md);
        min-height: 260px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #0f172a;
        padding: 8px;
      }

      .question img {
        max-width: 100%;
        max-height: 360px;
        object-fit: contain;
        border-radius: 6px;
        box-shadow: 0 6px 20px rgba(2, 6, 23, 0.04);
      }

      .options {
        margin-top: 8px;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
      }

      .opt {
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #fde8d6;
        font-size: 13px;
        display: flex;
        gap: 8px;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-weight: 900;
        background: #fff5f0;
        color: #0f172a;
        transition: all 0.2s ease;
      }

      .opt:hover {
        background: #fff0e6;
        border-color: #ffcdb3;
      }

      .opt.selected {
        border: 1px solid #ff9a3d;
        background: #fff6f0;
        color: #ff9a3d;
        box-shadow: 0 6px 16px rgba(255, 154, 61, 0.15);
      }

      .controls {
        display: flex;
        gap: 8px;
        align-items: center;
        justify-content: center;
        padding: 12px 16px;
        background: linear-gradient(90deg, #1a1f3a, #161b2e);
        border-radius: 12px;
        border: 1px solid rgba(255, 154, 61, 0.1);
        box-shadow:
          0 10px 40px rgba(0, 0, 0, 0.4),
          inset 0 1px 1px rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(10px);
      }

      button {
        font-weight: 800;
        border: 0;
        border-radius: 8px;
        cursor: pointer;
        padding: 8px 14px;
        font-size: 12px;
        transition: all 0.3s ease;
      }

      .btn-primary {
        background: linear-gradient(135deg, #ff9a3d, #ffb84d);
        color: #fff;
        box-shadow: 0 8px 24px rgba(255, 154, 61, 0.3);
        border: 1px solid rgba(255, 154, 61, 0.4);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 32px rgba(255, 154, 61, 0.4);
      }

      .btn-secondary {
        background: rgba(51, 65, 85, 0.5);
        border: 1px solid rgba(255, 154, 61, 0.2);
        color: #cbd5e1;
      }

      .btn-secondary:hover {
        background: rgba(71, 85, 105, 0.6);
        border-color: rgba(255, 154, 61, 0.4);
        color: #fff;
      }

      .btn-danger {
        background: linear-gradient(135deg, #ef4444, #f87171);
        color: #fff;
        box-shadow: 0 8px 24px rgba(239, 68, 68, 0.3);
        border: 1px solid rgba(239, 68, 68, 0.4);
      }

      .btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 32px rgba(239, 68, 68, 0.4);
      }

      .side h3 {
        margin: 0;
        font-size: 14px;
        color: #fff;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .seg {
        display: flex;
        gap: 8px;
        margin-top: 10px;
        flex-wrap: wrap;
        align-items: center;
        justify-content: center;
      }

      .seg button {
        flex: 0 1 auto;
        padding: 6px 12px;
        border-radius: 8px;
        background: rgba(51, 65, 85, 0.4);
        border: 1px solid rgba(255, 154, 61, 0.15);
        font-weight: 800;
        font-size: 11px;
        cursor: pointer;
        min-width: 0;
        color: #cbd5e1;
        transition: all 0.3s ease;
      }

      .seg button:hover {
        background: rgba(71, 85, 105, 0.5);
        border-color: rgba(255, 154, 61, 0.3);
      }

      .seg button.active {
        background: linear-gradient(135deg, #ff9a3d, #ffb84d);
        border-color: rgba(255, 154, 61, 0.5);
        color: #fff;
        box-shadow: 0 8px 20px rgba(255, 154, 61, 0.25);
      }

      .picker {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: var(--qgap);
        margin-top: 10px;
        overflow: auto;
        max-height: calc(100% - 240px);
        padding-right: 6px;
      }

      .picker::-webkit-scrollbar {
        width: 6px;
      }

      .picker::-webkit-scrollbar-track {
        background: rgba(255, 154, 61, 0.05);
        border-radius: 3px;
      }

      .picker::-webkit-scrollbar-thumb {
        background: rgba(255, 154, 61, 0.3);
        border-radius: 3px;
      }

      .picker::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 154, 61, 0.5);
      }

      .qbtn {
        height: var(--qbtn);
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(51, 65, 85, 0.4);
        border: 1px solid rgba(255, 154, 61, 0.15);
        font-weight: 800;
        font-size: 12px;
        cursor: pointer;
        position: relative;
        overflow: visible;
        color: #cbd5e1;
        transition: all 0.2s ease;
      }

      .qbtn:hover {
        background: rgba(71, 85, 105, 0.5);
        border-color: rgba(255, 154, 61, 0.3);
      }

      .qbtn.answered {
        background: rgba(34, 197, 94, 0.2);
        border-color: rgba(34, 197, 94, 0.4);
        color: #86efac;
      }

      .qbtn.review {
        background: rgba(59, 130, 246, 0.2);
        border-color: rgba(59, 130, 246, 0.4);
        color: #93c5fd;
      }

      /* VIEWED state: non-filled but with small orange corner ribbon */
      /* This creates a triangular ribbon at top-left */
      .qbtn.viewed {
        background: rgba(255, 154, 61, 0.15);
        border-color: rgba(255, 154, 61, 0.3);
        color: #ffa726;
      }

      .qbtn.viewed::before {
        content: "";
        position: absolute;
        left: -1px;
        top: -1px;
        width: 0;
        height: 0;
        border-top: 20px solid rgba(255, 154, 61, 0.8);
        border-right: 20px solid transparent;
        border-left: 0;
        transform-origin: 0 0;
        border-bottom: 0;
        z-index: 2;
        border-top-left-radius: 4px;
      }

      .qbtn.viewed::after {
        content: "";
        position: absolute;
        left: 3px;
        top: 2px;
        width: 6px;
        height: 6px;
        transform: rotate(45deg);
        background: rgba(255, 255, 255, 0.4);
        z-index: 3;
        border-radius: 1px;
      }

      .legend {
        margin-top: 16px;
        padding-top: 12px;
        font-size: 12px;
        color: #cbd5e1;
        border-top: 1px solid rgba(255, 154, 61, 0.1);
      }

      .legend .item {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-top: 8px;
      }

      .sw {
        width: 12px;
        height: 12px;
        border-radius: 3px;
        display: inline-block;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      /* make overlays scrollable when content taller than viewport */
      /* ===============================
   FULL SCREEN MOCK START MODAL
   =============================== */

      .overlay {
        display: none;
        position: fixed;
        inset: 0;
        z-index: 1800;
        background: linear-gradient(180deg, #0a0e27, #0f1535, #141a2e);
        padding: 0;
        overflow: auto;
      }

      /* Blinking dot animation for test in progress */
      @keyframes blinkingDot {
        0%,
        49% {
          opacity: 1;
          transform: scale(1);
        }
        50%,
        100% {
          opacity: 0.3;
          transform: scale(0.8);
        }
      }

      .status-dot {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: linear-gradient(135deg, #10b981, #34d399);
        animation: blinkingDot 1.2s ease-in-out infinite;
        box-shadow: 0 0 8px rgba(16, 185, 129, 0.6);
        margin-left: 8px;
        vertical-align: middle;
      }

      .start-card {
        width: 100vw;
        height: 100vh;
        max-width: none;
        max-height: none;
        border-radius: 0;
        box-shadow: none;
        border: 0;
        padding: 32px;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .start-card h2 {
        color: #fff;
        font-size: 28px;
        font-weight: 800;
        margin: 0 0 12px 0;
        letter-spacing: 0.5px;
      }

      .start-card p {
        color: #cbd5e1;
        font-size: 14px;
        line-height: 1.6;
        margin: 0;
      }

      .mock-card {
        width: 100%;
        padding: 20px 24px;
        border-radius: 12px;
        background: linear-gradient(
          180deg,
          rgba(255, 154, 61, 0.08),
          rgba(255, 154, 61, 0.03)
        );
        border: 1px solid rgba(255, 154, 61, 0.2);
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        gap: 20px;
        transition:
          transform 0.25s ease,
          box-shadow 0.25s ease;
      }

      .mock-card.inactive {
        opacity: 0.45;
        filter: grayscale(35%);
        pointer-events: none;
      }

      .mock-card.inactive::after {
        content: "Locked";
        position: absolute;
        right: 16px;
        top: 16px;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 11px;
        font-weight: 800;
        background: rgba(255, 154, 61, 0.2);
        color: #ff9a3d;
        border: 1px solid rgba(255, 154, 61, 0.4);
      }

      .mock-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 60px rgba(255, 154, 61, 0.2);
        border-color: rgba(255, 154, 61, 0.4);
        background: linear-gradient(
          180deg,
          rgba(255, 154, 61, 0.12),
          rgba(255, 154, 61, 0.06)
        );
      }

      .login-screen {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(
          135deg,
          #0f172a 0%,
          #1a1f35 35%,
          #16213e 100%
        );
        z-index: 2500;
        padding: 0px;
        backdrop-filter: blur(2px);
      }

      /* overlay for async loading states */
      .loading-overlay {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        background: rgba(0, 0, 0, 0.5);
        z-index: 3000;
      }
      .loading-overlay img {
        width: 80px;
        height: 80px;
      }

      /* fullscreen layout (no floating card) */
      .px-login-fullscreen {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        gap: 0;
        align-items: stretch;
        justify-content: center;
      }

      .px-login-top {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 24px 32px;
        border-bottom: none;
        background: transparent;
        box-shadow: none;
      }

      .px-login-top h1 {
        font-family: "Playfair Display", serif;
        font-size: 24px;
        font-weight: 800;
        letter-spacing: 0.5px;
        color: #fff;
        line-height: 1.3;
        margin: 0;
      }

      .px-login-center {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 40px 32px 120px;
        background: transparent;
      }

      .px-login-column {
        display: flex;
        flex-direction: column;
        gap: 20px;
        max-width: 480px;
        margin: auto;
        width: 100%;
      }

      .welcome {
        font-family: "Playfair Display", serif;
        font-size: 28px;
        font-weight: 800;
        color: #fff;
        margin: 0 0 6px 0;
        letter-spacing: 0.3px;
      }

      .welcome + p {
        color: #a0aec0 !important;
        font-size: 14px !important;
      }

      .px-input {
        width: 100%;
        padding: 14px 16px;
        border-radius: 10px;
        border: 1.5px solid #404863;
        background: rgba(30, 41, 59, 0.6);
        font-size: 14px;
        outline: none;
        font-weight: 500;
        color: #fff;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      }

      .px-input::placeholder {
        color: #718096;
        font-weight: 500;
      }

      .px-input:hover {
        border-color: #ff9a3d;
        background: rgba(30, 41, 59, 0.8);
        box-shadow: 0 6px 24px rgba(255, 154, 61, 0.08);
      }

      .px-input:focus {
        box-shadow:
          0 0 0 3px rgba(255, 154, 61, 0.1),
          0 8px 24px rgba(255, 154, 61, 0.15);
        border-color: #ff9a3d;
        background: rgba(30, 41, 59, 0.95);
        transform: translateY(-2px);
      }

      .px-actions {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        margin-top: 12px;
      }

      .px-btn {
        padding: 13px 28px;
        border-radius: 10px;
        font-weight: 800;
        border: 0;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 8px 20px rgba(255, 154, 61, 0.15);
      }

      .px-btn.primary {
        background: linear-gradient(135deg, #ff9a3d 0%, #ffb84d 100%);
        color: #fff;
        flex: 1;
      }

      .px-btn.primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 32px rgba(255, 154, 61, 0.3);
        background: linear-gradient(135deg, #ffb84d 0%, #ffb74d 100%);
      }

      .px-btn.primary:active {
        transform: translateY(-1px);
      }

      .px-help {
        color: #f87171;
        font-size: 12px;
        min-height: 18px;
        font-weight: 600;
      }

      .px-register {
        text-align: center;
        font-size: 13px;
        color: #a0aec0;
        margin-top: 4px;
      }

      .px-register a {
        color: #ff9a3d;
        text-decoration: none;
        font-weight: 700;
        transition: all 0.2s;
      }

      .px-register a:hover {
        color: #ffb84d;
        text-decoration: underline;
      }

      .px-login-visual {
        width: 320px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 12px;
        padding: 18px;
        background: linear-gradient(180deg, #fff6f0, #fff2ec);
        border-radius: 12px;
        border: 1px solid rgba(255, 230, 210, 0.8);
      }
      .px-login-grid {
        width: 100%;
        max-width: 1000px;
        display: grid;
        grid-template-columns: 480px 1fr;
        gap: 60px;
        align-items: center;
      }

      .login-features {
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .login-features-title {
        font-family: "Playfair Display", serif;
        font-size: 22px;
        font-weight: 800;
        color: #fff;
        margin: 0 0 8px 0;
        letter-spacing: 0.3px;
      }

      .login-features-subtitle {
        font-size: 13px;
        color: #a0aec0;
        margin: 0 0 16px 0;
      }

      .features-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .feature-item {
        display: flex;
        align-items: flex-start;
        gap: 14px;
      }

      .feature-item svg {
        width: 24px;
        height: 24px;
        color: #ff9a3d;
        flex-shrink: 0;
        margin-top: 2px;
      }

      .feature-item span {
        font-size: 14px;
        color: #cbd5e1;
        line-height: 1.5;
        font-weight: 500;
      }

      .feature-item span strong {
        color: #fff;
        font-weight: 700;
      }

      @media (max-width: 1100px) {
        .px-login-grid {
          grid-template-columns: 1fr;
          gap: 40px;
        }

        .login-features {
          padding: 24px;
          background: rgba(30, 41, 59, 0.4);
          border-radius: 12px;
          border: 1px solid rgba(255, 154, 61, 0.1);
        }
      }

      @media (max-width: 768px) {
        .px-login-grid {
          gap: 32px;
        }

        .login-features {
          display: none;
        }
      }

      .link-btn {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 14px;
        border-radius: 12px;
        font-weight: 700;
        text-decoration: none;
        font-size: 12px;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.8),
          rgba(255, 250, 245, 0.9)
        );
        border: 2px solid rgba(255, 220, 190, 0.3);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
        width: 100%;
        text-align: center;
        justify-content: center;
      }

      .link-btn img {
        width: 22px;
        height: 22px;
        transition: transform 0.2s ease;
      }

      .link-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        border-color: rgba(249, 115, 22, 0.5);
      }

      .link-btn:hover img {
        transform: scale(1.1);
      }

      .link-btn.whatsapp {
        color: #128c7e;
      }

      .link-btn.whatsapp:hover {
        background: linear-gradient(
          135deg,
          rgba(18, 140, 126, 0.1),
          rgba(18, 140, 126, 0.05)
        );
        border-color: #128c7e;
      }

      .link-btn.youtube {
        color: #e11d48;
      }

      .link-btn.youtube:hover {
        background: linear-gradient(
          135deg,
          rgba(225, 29, 72, 0.1),
          rgba(225, 29, 72, 0.05)
        );
        border-color: #e11d48;
      }

      .link-btn.telegram {
        color: #2563eb;
      }

      .link-btn.telegram:hover {
        background: linear-gradient(
          135deg,
          rgba(37, 99, 235, 0.1),
          rgba(37, 99, 235, 0.05)
        );
        border-color: #2563eb;
      }

      #detail-overlay {
        display: none;
        position: fixed;
        inset: 0;
        z-index: 2100;

        align-items: stretch;
        justify-content: stretch;

        background: rgba(8, 10, 12, 0.45);
        backdrop-filter: blur(6px) saturate(105%);

        padding: 0;
      }

      .detail-card {
        width: 100vw;
        height: 100vh;
        max-width: none;
        min-height: 100vh;

        background: linear-gradient(180deg, #1a1f3a, #161b2e, #111827);
        border-radius: 0;

        display: grid;
        grid-template-columns: 1fr 360px;
        gap: 0;

        box-shadow: none;
        border: 0;
      }

      .detail-left {
        padding: 20px;
        overflow-y: auto;
        height: 100vh;
        background: linear-gradient(
          180deg,
          rgba(20, 26, 46, 0.5),
          rgba(15, 20, 35, 0.5)
        );
      }

      .detail-right {
        background: linear-gradient(
          180deg,
          rgba(26, 31, 58, 0.98),
          rgba(22, 27, 46, 0.98)
        );
        padding: 20px;
        border-left: 1px solid rgba(255, 154, 61, 0.2);

        display: flex;
        flex-direction: column;
        gap: 12px;
        align-items: stretch;

        min-width: 260px;
        height: 100vh;
      }

      .detail-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: 8px;
        padding-bottom: 12px;
        border-bottom: 1px solid rgba(255, 154, 61, 0.1);
      }

      .detail-title {
        font-size: 18px;
        font-weight: 800;
        color: #fff;
      }

      .detail-sub {
        font-size: 13px;
        color: #cbd5e1;
      }

      .score-badge {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 16px;
        border-radius: 12px;
        background: linear-gradient(
          180deg,
          rgba(255, 154, 61, 0.12),
          rgba(255, 154, 61, 0.06)
        );
        border: 1px solid rgba(255, 154, 61, 0.3);
        font-weight: 800;
        color: #fff;
        box-shadow: 0 10px 30px rgba(255, 154, 61, 0.1);
      }

      .stats-row {
        display: flex;
        gap: 8px;
        justify-content: space-between;
        align-items: center;
        font-size: 13px;
        color: #cbd5e1;
      }

      .stat {
        background: rgba(255, 154, 61, 0.08);
        border-radius: 10px;
        padding: 12px;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        min-width: 0;
        flex: 1;
        border: 1px solid rgba(255, 154, 61, 0.2);
      }

      .stat strong {
        font-size: 16px;
        color: #fff;
      }

      .stat span {
        font-size: 12px;
        color: #94a3b8;
      }

      .progress-wrap {
        width: 100%;
        margin-top: 4px;
      }

      .progress {
        height: 10px;
        background: rgba(255, 154, 61, 0.1);
        border-radius: 999px;
        border: 1px solid rgba(255, 154, 61, 0.2);
        overflow: hidden;
      }

      .progress > i {
        display: block;
        height: 100%;
        background: linear-gradient(90deg, #34d399, #10b981);
        width: 0%;
        transition: width 0.7s cubic-bezier(0.2, 0.9, 0.3, 1);
      }

      .perq {
        margin-top: 10px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .perq-item {
        display: flex;
        gap: 12px;
        align-items: center;
        padding: 12px 14px;
        border-radius: 10px;
        background: linear-gradient(
          180deg,
          rgba(255, 154, 61, 0.12),
          rgba(255, 154, 61, 0.06)
        );
        border: 1px solid rgba(255, 154, 61, 0.25);
      }

      .perq-left {
        min-width: 46px;
        text-align: center;
        font-weight: 800;
        color: #fff;
      }

      .perq-mid {
        flex: 1;
        font-size: 13px;
        color: #cbd5e1;
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
      }

      .perq-mid div {
        color: #cbd5e1;
      }

      .perq-mid .qid {
        font-weight: 800;
        color: #94a3b8;
        min-width: 40px;
      }

      .badge {
        padding: 6px 8px;
        border-radius: 999px;
        font-weight: 800;
        font-size: 12px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border: 1px solid rgba(0, 0, 0, 0.04);
      }

      .badge.correct {
        background: linear-gradient(
          90deg,
          rgba(16, 185, 129, 0.15),
          rgba(16, 185, 129, 0.1)
        );
        color: #86efac;
        border-color: rgba(16, 185, 129, 0.4);
      }

      .badge.wrong {
        background: linear-gradient(
          90deg,
          rgba(239, 68, 68, 0.15),
          rgba(239, 68, 68, 0.1)
        );
        color: #fca5a5;
        border-color: rgba(239, 68, 68, 0.4);
      }

      .badge.unseen {
        background: linear-gradient(
          90deg,
          rgba(255, 154, 61, 0.15),
          rgba(255, 154, 61, 0.1)
        );
        color: #ffb366;
        border-color: rgba(255, 154, 61, 0.4);
      }

      @media (max-width: 900px) {
        .side {
          display: none;
        }

        .app {
          padding: 6px;
        }
      }

      .user-badge {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 12px;
        border-radius: 8px;
        background: rgba(255, 154, 61, 0.15);
        border: 1px solid rgba(255, 154, 61, 0.3);
        box-shadow: 0 6px 16px rgba(255, 154, 61, 0.15);
      }

      .avatar {
        width: 28px;
        height: 28px;
        border-radius: 6px;
        background: linear-gradient(135deg, #ff9a3d, #ffb84d);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        font-size: 12px;
        color: #fff;
      }

      .user-name {
        font-weight: 700;
        font-size: 12px;
        color: #fff;
        max-width: 120px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .rules {
        text-align: left;
        max-width: 760px;
        line-height: 1.6;
        color: #cbd5e1;
      }

      .rules h3 {
        margin: 0 0 8px 0;
        font-size: 15px;
        color: #fff;
        font-weight: 700;
      }

      .rules ul {
        margin: 0 0 12px 0;
        padding-left: 20px;
      }

      .rules li {
        margin: 4px 0;
        color: #cbd5e1;
      }

      .rules ul {
        margin: 6px 0 0 18px;
        padding: 0;
      }

      .rules ul li {
        margin: 6px 0;
        font-weight: 700;
        font-size: 13px;
        color: #111;
      }

      .rules .muted {
        font-weight: 600;
        color: var(--muted);
        font-size: 12.5px;
        margin-top: 8px;
        display: block;
      }

      /* Confirmation modal styling - Dark theme */
      #confirm-submit-modal {
        position: fixed;
        inset: 0;
        display: none;
        z-index: 2500;
        align-items: center;
        justify-content: center;
        background: rgba(8, 10, 12, 0.75);
        padding: 18px;
        backdrop-filter: blur(4px);
      }

      .confirm-card {
        width: min(100%, 700px);
        background: linear-gradient(180deg, #1a1f3a, #161b2e, #111827);
        border-radius: 16px;
        padding: 28px;
        border: 1px solid rgba(255, 154, 61, 0.3);
        box-shadow:
          0 30px 80px rgba(0, 0, 0, 0.6),
          0 0 60px rgba(255, 154, 61, 0.1);
        display: flex;
        flex-direction: column;
        gap: 18px;
      }

      .confirm-row {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .confirm-title {
        font-size: 22px;
        font-weight: 900;
        color: #fff;
        letter-spacing: 0.5px;
      }

      .confirm-stats {
        font-size: 14px;
        color: #cbd5e1;
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-top: 8px;
      }

      .confirm-stat {
        background: linear-gradient(
          180deg,
          rgba(255, 154, 61, 0.12),
          rgba(255, 154, 61, 0.06)
        );
        padding: 12px 14px;
        border-radius: 10px;
        font-weight: 800;
        border: 1px solid rgba(255, 154, 61, 0.3);
        min-width: 150px;
        text-align: center;
        color: #fff;
      }

      .confirm-actions {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 12px;
      }

      /* Info button */
      .info-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 38px;
        height: 38px;
        border-radius: 50%;
        background: #fff6ed;
        border: 1px solid rgba(79, 79, 79, 0.8);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #000000;
        font-weight: 900;
      }

      .info-btn:hover {
        background: #ffe8d5;
      }

      /* Developer info modal */
      #dev-info-modal {
        position: fixed;
        inset: 0;
        display: none;
        z-index: 3000;
        align-items: center;
        justify-content: center;
        background: rgba(8, 10, 12, 0.45);
      }

      .dev-info-card {
        width: min(100%, 360px);
        background: #fff;
        border-radius: 12px;
        padding: 16px;
        box-shadow: 0 30px 80px rgba(2, 6, 23, 0.3);
        border: 1px solid rgba(255, 230, 210, 0.9);
      }

      .dev-info-card h3 {
        margin: 0 0 6px 0;
        color: #f97316;
        font-weight: 900;
      }

      .dev-info-card p {
        margin: 6px 0;
        font-size: 13px;
        color: #333;
      }

      /* LOGIN SCREEN LOGO */
      .px-login-top #login-banner {
        width: 60px;
        height: auto;
        border-radius: 10px;
        filter: brightness(1.1);
      }

      /* APP HEADER LOGO */
      .header .brand #app-banner {
        width: 50px;
        height: auto;
        border-radius: 8px;
      }

      .header {
        gap: 6px;
        padding: 0;
      }
      .brand {
        gap: 10px;
      }

      /* LOGIN FOOTER â€“ FULL WIDTH FIX */
      .login-footer {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100vw;
        padding: 18px 20px;
        border-top: 1px solid rgba(255, 154, 61, 0.1);
        background: transparent;
        font-size: 12px;
        font-weight: 700;
        color: #718096;
        z-index: 2600;
        box-shadow: none;
      }

      .login-footer-inner {
        max-width: 1200px;
        margin: auto;
        display: flex;
        gap: 8px;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
      }

      .login-footer a {
        color: #ff9a3d;
        text-decoration: none;
        font-weight: 800;
        transition: color 0.2s;
      }

      .login-footer a:hover {
        color: #ffb84d;
        text-decoration: underline;
      }

      .login-footer .sep {
        opacity: 0.4;
      }

      /* T&C and Privacy Modal */
      #legal-modal {
        display: none;
        position: fixed;
        inset: 0;
        z-index: 3000;
        align-items: center;
        justify-content: center;
        background: rgba(8, 10, 12, 0.85);
        padding: 20px;
        backdrop-filter: blur(4px);
      }

      .legal-modal-content {
        width: 100%;
        max-width: 900px;
        max-height: 85vh;
        background: linear-gradient(180deg, #1a1f3a, #161b2e, #111827);
        border-radius: 16px;
        border: 1px solid rgba(255, 154, 61, 0.3);
        box-shadow: 0 30px 100px rgba(0, 0, 0, 0.7);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .legal-modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px 24px;
        border-bottom: 1px solid rgba(255, 154, 61, 0.2);
        background: linear-gradient(
          180deg,
          rgba(26, 31, 58, 0.5),
          rgba(22, 27, 46, 0.3)
        );
      }

      .legal-modal-title {
        font-size: 18px;
        font-weight: 800;
        color: #fff;
        letter-spacing: 0.5px;
      }

      .legal-close-btn {
        background: transparent;
        border: none;
        cursor: pointer;
        padding: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #cbd5e1;
        transition: color 0.2s;
      }

      .legal-close-btn:hover {
        color: #ff9a3d;
      }

      .legal-modal-tabs {
        display: flex;
        gap: 0;
        padding: 0 24px;
        border-bottom: 1px solid rgba(255, 154, 61, 0.15);
        background: linear-gradient(
          180deg,
          rgba(20, 26, 46, 0.3),
          rgba(15, 20, 35, 0.2)
        );
      }

      .legal-modal-tab {
        padding: 12px 20px;
        border: none;
        background: transparent;
        color: #cbd5e1;
        font-weight: 700;
        font-size: 13px;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        transition: all 0.2s;
      }

      .legal-modal-tab:hover {
        color: #ff9a3d;
      }

      .legal-modal-tab.active {
        color: #ff9a3d;
        border-bottom-color: #ff9a3d;
      }

      .legal-modal-body {
        flex: 1;
        overflow-y: auto;
        padding: 24px;
        color: #cbd5e1;
        font-size: 12px;
        line-height: 1.7;
      }

      .legal-modal-body h3 {
        color: #fff;
        font-size: 14px;
        margin: 16px 0 8px 0;
        font-weight: 800;
      }

      .legal-modal-body h4 {
        color: #ff9a3d;
        font-size: 13px;
        margin: 12px 0 6px 0;
        font-weight: 700;
      }

      .legal-modal-body p {
        margin: 6px 0;
        text-align: justify;
      }

      .legal-modal-body ul {
        margin: 8px 0;
        padding-left: 20px;
      }

      .legal-modal-body li {
        margin: 4px 0;
      }

      .legal-modal-body::-webkit-scrollbar {
        width: 8px;
      }

      .legal-modal-body::-webkit-scrollbar-track {
        background: rgba(255, 154, 61, 0.05);
        border-radius: 4px;
      }

      .legal-modal-body::-webkit-scrollbar-thumb {
        background: rgba(255, 154, 61, 0.3);
        border-radius: 4px;
      }

      .legal-modal-body::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 154, 61, 0.5);
      }

      /* Mobile device warning screen */
      .mobile-warning {
        display: none;
        position: fixed;
        inset: 0;
        z-index: 9999;
        background: linear-gradient(
          135deg,
          #0f172a 0%,
          #1a1f35 35%,
          #16213e 100%
        );
        align-items: center;
        justify-content: center;
        flex-direction: column;
        gap: 24px;
        padding: 24px;
        text-align: center;
      }

      .mobile-warning-content {
        max-width: 360px;
        display: flex;
        flex-direction: column;
        gap: 16px;
        background: rgba(30, 41, 59, 0.9);
        padding: 40px 32px;
        border-radius: 16px;
        box-shadow: 0 24px 64px rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(255, 154, 61, 0.15);
      }

      .mobile-warning-icon {
        font-size: 72px;
        margin: 0;
        animation: float 3s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-12px);
        }
      }

      .mobile-warning h1 {
        font-family: "Playfair Display", serif;
        font-size: 28px;
        font-weight: 800;
        color: #fff;
        margin: 0;
        letter-spacing: 0.3px;
      }

      .mobile-warning p {
        font-size: 14px;
        color: #a0aec0;
        margin: 0;
        line-height: 1.6;
        font-weight: 500;
      }

      .mobile-warning .device-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 8px;
        text-align: left;
      }

      .mobile-warning .device-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: #cbd5e1;
        font-weight: 600;
      }

      .mobile-warning .device-item::before {
        content: "âœ“";
        color: #ff9a3d;
        font-weight: 800;
        font-size: 16px;
      }

      @media (max-width: 768px) {
        .mobile-warning {
          display: flex !important;
        }

        .px-login-fullscreen {
          display: none !important;
        }

        .login-footer {
          display: none !important;
        }

        .login-screen {
          background: linear-gradient(
            135deg,
            #0f172a 0%,
            #1a1f35 35%,
            #16213e 100%
          );
        }
      }

      @media (min-width: 769px) {
        .mobile-warning {
          display: none !important;
        }
      }

      /* ===============================
   QUESTION IMAGE WATERMARK
   =============================== */

      .question {
        position: relative;
      }

      /* wrapper for image watermark */
      .question img {
        position: relative;
        z-index: 1;
      }

      /* watermark overlay */
      .question::after {
        content: "";
        position: absolute;
        inset: 0;
        background-image: url("favicon.png");
        background-repeat: no-repeat;
        background-position: center;
        background-size: 30%;
        opacity: 0.08;
        pointer-events: none;
        z-index: 2;
      }

      .question {
        position: relative;
        user-select: none;
      }

      .question img {
        pointer-events: none;
        user-select: none;
        -webkit-user-drag: none;
        -webkit-touch-callout: none;
        cursor: default !important;
      }

      /* ===== FIX BUTTON + ICON SIZE ===== */
      button,
      .btn-primary,
      .btn-secondary,
      .btn-danger {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        padding: 6px 10px;
        font-size: 12px;
        line-height: 1;
        height: 32px; /* ðŸ”‘ fixed height */
        white-space: nowrap;
      }

      /* lucide icons inside buttons */
      button svg,
      button i[data-lucide] {
        width: 16px;
        height: 16px;
        stroke-width: 2;
        flex-shrink: 0;
      }
      .header .meta button {
        height: 34px;
        padding: 6px 12px;
        font-size: 12px;
        border-radius: 10px;
      }
      #open-start {
        padding: 6px 14px;
        font-size: 12px;
      }
      .controls button {
        min-width: 72px;
        height: 34px;
      }
      @media (max-width: 900px) {
        .controls button span {
          display: none;
        }
      }

      /* Left side (test info) */
      .mock-card .left {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .mock-card .left h4 {
        margin: 0;
        font-size: 15px;
        font-weight: 900;
        color: #111;
      }

      .mock-card .left span {
        font-size: 12.5px;
        color: var(--muted);
        font-weight: 700;
      }

      /* Right side (button / status) */
      .mock-card .right {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      @media (max-width: 768px) {
        .mock-card {
          flex-direction: column;
          align-items: flex-start;
        }

        .mock-card .right {
          width: 100%;
          justify-content: flex-end;
        }
      }
      /* =====================================================
   ðŸ”¥ FINAL MOCK START MODAL FIX â€” DROP-IN BLOCK
   Paste this AT THE VERY END of your CSS
   ===================================================== */

      /* FULLSCREEN OVERLAY */
      .overlay {
        display: none;
        position: fixed;
        inset: 0;
        z-index: 3000;
        background: linear-gradient(180deg, #fff6ef, #fff2ea);
        overflow-y: auto;
      }

      /* FULLSCREEN CONTAINER */
      .start-card {
        width: 100vw;
        height: 100vh;
        max-width: none;
        max-height: none;
        border-radius: 0;
        border: 0;
        box-shadow: none;
        padding: 24px;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      /* FORCE MOCK LIST â†’ ONE COLUMN */
      .start-card > * {
        display: flex !important;
        flex-direction: column !important;
        gap: 14px;
        width: 100%;
      }

      /* LONG HORIZONTAL MOCK CARD */
      .mock-card {
        position: relative;
        width: 100%;
        padding: 18px 22px;
        border-radius: 16px;
        background: linear-gradient(180deg, #ffffff, #fffaf7);
        border: 1px solid rgba(255, 220, 190, 0.9);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        opacity: 1 !important;
        filter: none !important;
        transition:
          transform 0.25s ease,
          box-shadow 0.25s ease,
          border-color 0.25s ease;
      }

      /* HOVER EFFECT */
      .mock-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 18px 50px rgba(249, 115, 22, 0.18);
        border-color: #ffb680;
      }

      /* LOCKED STATE */
      .mock-card.inactive {
        opacity: 0.45 !important;
        filter: grayscale(35%) !important;
        pointer-events: none;
      }

      .mock-card.inactive::after {
        content: "Locked";
        position: absolute;
        top: 14px;
        right: 16px;
        padding: 6px 12px;
        border-radius: 999px;
        font-size: 12px;
        font-weight: 900;
        background: #fff;
        color: #b45309;
        border: 1px solid rgba(255, 200, 160, 0.7);
      }

      /* LEFT CONTENT */
      .mock-card .left {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .mock-card .left h4 {
        margin: 0;
        font-size: 15px;
        font-weight: 900;
        color: #111;
      }

      .mock-card .left span {
        font-size: 12.5px;
        color: var(--muted);
        font-weight: 700;
      }

      /* RIGHT ACTIONS */
      .mock-card .right {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      /* MOBILE SAFE */
      @media (max-width: 768px) {
        .mock-card {
          flex-direction: column;
          align-items: flex-start;
        }

        .mock-card .right {
          width: 100%;
          justify-content: flex-end;
        }
      }

      .mock-card {
        display: grid !important;
        grid-template-columns: 180px 130px 150px 1fr 110px 90px;
        align-items: center;
        column-gap: 18px;
      }

      .mock-card .left h4 {
        font-size: 15px;
        font-weight: 900;
        white-space: nowrap;
      }

      .mock-card .meta-time {
        font-weight: 700;
        color: var(--muted);
        white-space: nowrap;
      }

      .mock-card .meta-date {
        font-weight: 800;
        color: #111;
        white-space: nowrap;
      }

      .mock-card .meta-syllabus {
        font-weight: 700;
        color: #333;
        line-height: 1.35;
      }

      .mock-card .right {
        justify-self: end;
        display: flex;
        gap: 10px;
      }

      .mock-card .status {
        justify-self: end;
        font-weight: 900;
        white-space: nowrap;
      }

      @media (max-width: 1400px) {
        .side {
          width: 32%;
        }
      }

      @media (max-width: 1200px) {
        .side {
          width: 35%;
        }

        .header {
          padding: 10px 14px;
        }

        .controls {
          padding: 10px 14px;
          gap: 6px;
        }

        .title {
          font-size: 20px;
        }
      }

      @media (max-width: 1024px) {
        .side {
          width: 38%;
        }

        .options {
          grid-template-columns: repeat(2, 1fr);
        }

        .title {
          font-size: 18px;
        }

        button {
          padding: 6px 12px;
          font-size: 11px;
        }
      }
    </style>
  </head>

  <body>
    <!-- MAIN APP -->
    <div class="app" id="app" aria-hidden="true">
      <div class="main">
        <div class="header">
          <div class="brand">
            <img id="app-banner" src="assets/banner.jpeg" alt="PROYAX Banner" />
            <div>
              <div class="title">CEE Mock Test</div>
              <div class="subtitle">
                Secure your seat with practice-driven mock tests
              </div>
            </div>
          </div>
        </div>

        <div class="question-card" id="question-card">
          <div class="question-top">
            <div>
              <div class="qno" id="qno">Question 1</div>
              <div class="meta-sm" id="qtime">Time spent: 00:00</div>
            </div>
            <div class="meta-sm" id="qstatus">Status: Unseen</div>
          </div>

          <!-- SHOW RULES & DASHBOARD HELP BEFORE START -->
          <div class="question" id="question">
            <div class="rules" id="rules-block">
              <h3>Rules</h3>
              <ul>
                <li>+4 for a correct answer</li>
                <li>-1 for a wrong answer</li>
                <li>0 for unanswered questions</li>
                <li>
                  Only one attempt allowed per mock â€” reattempts are not
                  permitted
                </li>
                <li>
                  Use <strong>Mark</strong> to flag questions for review and
                  submit when done
                </li>
              </ul>

              <h3 style="margin-top: 10px">Dashboard â€” quick guide</h3>
              <ul>
                <li>
                  Timer (top-right): shows elapsed time for your current
                  attempt.
                </li>
                <li>
                  Question palette (right): jump to any question in the section;
                  colored badges show answered/marked status.
                </li>
                <li>
                  Controls (bottom): <strong>Prev/Next</strong> to navigate,
                  <strong>Mark</strong> to flag, and <strong>Submit</strong> to
                  finish.
                </li>
                <li>
                  Results: after submission you can view per-question outcome,
                  time used and summary analytics in the "Results" window.
                </li>
              </ul>

              <div class="muted">
                When you're ready, click <strong>Start</strong> to begin the
                mock. Good luck!
              </div>
            </div>
          </div>

          <div class="options" id="options"></div>
        </div>

        <div class="controls">
          <button class="btn-secondary" id="mark-review">
            <i data-lucide="bookmark"></i> Mark
          </button>

          <button class="btn-secondary" id="clear-btn">
            <i data-lucide="eraser"></i> Clear
          </button>

          <button class="btn-secondary" id="prev-btn">
            <i data-lucide="chevron-left"></i> Prev
          </button>

          <button class="btn-primary" id="next-btn">
            <i data-lucide="chevron-right"></i>
            <span>Next</span>
          </button>

          <button class="btn-danger" id="submit-btn">
            <i data-lucide="send"></i> Submit
          </button>
        </div>
      </div>

      <div class="side" aria-hidden="true">
        <div class="side-top" id="side-controls">
          <div class="row1">
            <div id="user-badge" class="user-badge" style="display: none">
              <div id="user-avatar" class="avatar">U</div>
              <div id="user-name" class="user-name">
                User<span
                  id="status-dot"
                  class="status-dot"
                  style="display: none"
                ></span>
              </div>
            </div>

            <div style="display: flex; align-items: center; gap: 8px">
              <div style="color: #cbd5e1; font-weight: 800; font-size: 12px">
                Time Remaining:
              </div>
              <div class="timer" id="global-timer">00:00:00</div>
            </div>
          </div>

          <div class="row2">
            <button
              id="open-start"
              class="control-btn start-locked"
              style="display: none"
            >
              <i data-lucide="play"></i> <span>Start</span>
              <span class="lock-icon">ðŸ”’</span>
            </button>
            <button
              id="fullscreen-btn"
              class="control-btn"
              title="Toggle Fullscreen"
            >
              <i data-lucide="maximize-2"></i>
            </button>
            <button id="results-btn" class="control-btn" style="display: none">
              <i data-lucide="bar-chart-3"></i>
            </button>
            <button id="logout-btn" class="control-btn" style="display: none">
              <i data-lucide="log-out"></i>
            </button>
          </div>
        </div>

        <h3>Choose Section</h3>
        <div class="seg">
          <button id="btn-phy" class="active">Physics</button>
          <button id="btn-chem">Chemistry</button>
          <button id="btn-math">Mathematics</button>
        </div>

        <div
          id="section-picker"
          class="picker"
          aria-label="Question picker"
        ></div>

        <div
          class="live-summary"
          id="live-summary"
          style="margin-top: 12px; color: #cbd5e1"
        >
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 8px;
            "
          >
            <div style="font-weight: 800; color: #fff">Live Summary</div>
            <div style="font-size: 12px; color: #94a3b8">Subject-wise</div>
          </div>
          <div
            style="
              display: flex;
              flex-direction: column;
              gap: 8px;
              font-size: 13px;
            "
          >
            <div
              style="display: flex; justify-content: space-between; gap: 8px"
            >
              <div><strong>Physics</strong></div>
              <div style="color: #94a3b8">
                Attempted: <span id="phy-attempted">0</span> &nbsp; Marked:
                <span id="phy-marked">0</span> &nbsp; Unattempted:
                <span id="phy-un">0</span>
              </div>
            </div>
            <div
              style="display: flex; justify-content: space-between; gap: 8px"
            >
              <div><strong>Chemistry</strong></div>
              <div style="color: #94a3b8">
                Attempted: <span id="chem-attempted">0</span> &nbsp; Marked:
                <span id="chem-marked">0</span> &nbsp; Unattempted:
                <span id="chem-un">0</span>
              </div>
            </div>
            <div
              style="display: flex; justify-content: space-between; gap: 8px"
            >
              <div><strong>Mathematics</strong></div>
              <div style="color: #94a3b8">
                Attempted: <span id="math-attempted">0</span> &nbsp; Marked:
                <span id="math-marked">0</span> &nbsp; Unattempted:
                <span id="math-un">0</span>
              </div>
            </div>
          </div>
        </div>

        <div class="legend">
          <div
            style="
              font-weight: 700;
              margin-top: 0;
              display: flex;
              align-items: center;
              gap: 8px;
            "
          >
            <span
              style="
                font-size: 10px;
                letter-spacing: 0.5px;
                text-transform: uppercase;
              "
              >Legend</span
            >
          </div>
          <div class="item">
            <span
              class="sw"
              style="
                background: rgba(255, 154, 61, 0.2);
                border: 1px solid rgba(255, 154, 61, 0.3);
              "
            ></span>
            Unseen / Viewed
          </div>
          <div class="item">
            <span
              class="sw"
              style="
                background: rgba(34, 197, 94, 0.2);
                border: 1px solid rgba(34, 197, 94, 0.4);
              "
            ></span>
            Answered
          </div>
          <div class="item">
            <span
              class="sw"
              style="
                background: rgba(59, 130, 246, 0.2);
                border: 1px solid rgba(59, 130, 246, 0.4);
              "
            ></span>
            Marked
          </div>
        </div>

        <div
          style="
            margin-top: auto;
            font-size: 11px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 700;
          "
        >
          Navigation
        </div>
        <div style="height: 8px"></div>
      </div>
    </div>

    <!-- START MODAL, HISTORY, DETAIL (same as before) -->
    <div class="overlay start-modal" id="start-modal" aria-hidden="true">
      <div
        class="start-card"
        role="dialog"
        aria-modal="true"
        aria-labelledby="start-title"
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
          "
        >
          <h3
            id="start-title"
            style="
              margin: 0;
              font-size: 16px;
              color: #fff;
              font-weight: 800;
              letter-spacing: 0.5px;
            "
          >
            Select Mock
          </h3>
          <button id="close-mocks" class="btn-secondary">
            <i data-lucide="x"></i> Close
          </button>
        </div>
        <div
          id="mocks-container"
          style="
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 8px;
            margin-top: 10px;
          "
        ></div>
      </div>
    </div>

    <div class="overlay" id="history-overlay" style="display: none">
      <div
        style="
          width: 100%;
          max-width: 880px;
          background: linear-gradient(
            180deg,
            rgba(26, 31, 58, 0.95),
            rgba(22, 27, 46, 0.95)
          );
          border: 1px solid rgba(255, 154, 61, 0.2);
          padding: 20px;
          border-radius: 12px;
          overflow: auto;
          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
        "
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
          "
        >
          <h3
            style="
              margin: 0;
              color: #fff;
              font-weight: 800;
              font-size: 18px;
              letter-spacing: 0.5px;
            "
          >
            Your Submissions
          </h3>
          <button id="close-history" class="btn-secondary">Close</button>
        </div>
        <div
          id="history-grid"
          style="
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 16px;
          "
        ></div>
      </div>
    </div>

    <div class="overlay" id="detail-overlay" style="display: none">
      <div
        class="detail-card"
        role="dialog"
        aria-modal="true"
        aria-labelledby="detail-title"
      >
        <div class="detail-left">
          <div class="detail-header">
            <div>
              <div id="detail-title" class="detail-title">Submission</div>
              <div id="detail-sub" class="detail-sub">Summary</div>
            </div>
            <div style="display: flex; gap: 8px; align-items: center">
              <div id="detail-score" class="score-badge">
                <div class="big">0</div>
                <div class="small">Score</div>
              </div>
              <button id="close-detail" class="btn-secondary">Close</button>
            </div>
          </div>

          <div class="stats-row" aria-hidden="false">
            <div class="stat">
              <strong id="stat-correct">0</strong>
              <span>Correct</span>
            </div>
            <div class="stat">
              <strong id="stat-wrong">0</strong>
              <span>Wrong</span>
            </div>
            <div class="stat">
              <strong id="stat-unanswered">0</strong>
              <span>Unanswered</span>
            </div>
          </div>

          <div class="progress-wrap" aria-hidden="false">
            <div style="font-size: 12px; color: #cbd5e1; margin-top: 6px">
              Completion
            </div>
            <div class="progress" aria-hidden="false">
              <i id="progress-bar"></i>
            </div>
          </div>

          <div class="perq" id="perq-list" aria-live="polite"></div>
        </div>

        <div class="detail-right">
          <div style="display: flex; flex-direction: column; gap: 10px">
            <div style="font-weight: 800; color: #fff; font-size: 15px">
              Detailed results
            </div>
            <div style="font-size: 13px; color: #cbd5e1">
              Review per-question outcome, time used and score. Use the badges
              to quickly spot errors and revise those topics.
            </div>

            <div
              style="
                display: flex;
                flex-direction: column;
                gap: 8px;
                margin-top: 6px;
              "
            >
              <div style="font-size: 13px; color: #cbd5e1">Total Score</div>
              <div
                class="score-badge"
                style="
                  align-items: flex-start;
                  padding: 10px;
                  border-radius: 12px;
                "
              >
                <div style="font-size: 22px; font-weight: 900" id="right-total">
                  0
                </div>
                <div style="font-size: 12px; color: #94a3b8; font-weight: 700">
                  Out of <span id="right-max">0</span>
                </div>
              </div>
              <div style="font-size: 13px; color: #cbd5e1">Duration</div>
              <div style="font-weight: 800; color: #fff" id="right-duration">
                00:00
              </div>
            </div>

            <div style="margin-top: auto">
              <button
                id="close-detail-bottom"
                class="btn-secondary"
                style="width: 100%"
              >
                Close
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Confirmation modal for submit -->
    <div id="confirm-submit-modal" role="dialog" aria-modal="true">
      <div class="confirm-card" role="document">
        <div class="confirm-row">
          <div class="confirm-title">Confirm Submission</div>
          <div style="font-size: 12px; color: #cbd5e1">
            Please review your attempt summary before confirming
          </div>
        </div>
        <div class="confirm-stats" id="confirm-stats">
          <div class="confirm-stat" id="confirm-attempted">Attempted: 0</div>
          <div class="confirm-stat" id="confirm-left">Left: 0</div>
          <div class="confirm-stat" id="confirm-remaining">
            Time left: 00:00:00
          </div>
        </div>

        <div style="font-size: 13px; color: #cbd5e1">
          If you proceed, your attempt will be submitted and saved. Reattempts
          are not permitted for this mock.
        </div>

        <div class="confirm-actions">
          <button id="confirm-submit-no" class="btn-secondary">
            <i data-lucide="x-circle"></i> Cancel
          </button>

          <button id="confirm-submit-yes" class="btn-danger">
            <i data-lucide="check-circle"></i> Confirm submit
          </button>
        </div>
      </div>
    </div>

    <!-- FULLSCREEN LOGIN (no demo) -->
    <!-- loading overlay shown during async operations -->
    <div id="loading-overlay" class="loading-overlay">
      <img src="loading.gif" alt="Loading..." />
    </div>
    <div id="login-screen" class="login-screen" role="dialog" aria-modal="true">
      <!-- MOBILE WARNING SCREEN -->
      <div class="mobile-warning">
        <div class="mobile-warning-content">
          <div class="mobile-warning-icon">ðŸ’»</div>
          <h1>Desktop Access Required</h1>
          <p>
            PROYAX Mock Tests are optimized for desktop and tablet experiences.
          </p>

          <div class="device-list">
            <div class="device-item">Laptop or Desktop Computer</div>
            <div class="device-item">Tablet (iPad or Android)</div>
          </div>

          <p style="color: #999; font-size: 13px; margin-top: 12px">
            Please use a larger screen device to access the platform.
          </p>
        </div>
      </div>

      <div class="px-login-fullscreen">
        <div class="px-login-top">
          <img id="login-banner" src="assets/banner.jpeg" alt="PROYAX Banner" />
          <h1>
            PROYAX - Assam CEE(Combined Entrance Examination) 2026 Mock Test
            Series
          </h1>
        </div>
        <div class="px-login-center">
          <div class="px-login-grid">
            <!-- CENTER FORM -->
            <form class="px-login-column" id="login-form" autocomplete="off">
              <div style="margin-bottom: 4px">
                <h2 class="welcome">Welcome Back!</h2>
                <p
                  style="
                    margin: 6px 0 0 0;
                    font-size: 12px;
                    color: #999;
                    font-weight: 500;
                  "
                >
                  Login to your PROYAX account
                </p>
              </div>

              <input
                id="login-username"
                class="px-input"
                type="email"
                placeholder="Enter your email"
                required
              />

              <input
                id="login-password"
                class="px-input"
                type="password"
                placeholder="Enter your password"
                required
              />

              <div class="px-actions">
                <button type="submit" id="login-btn" class="px-btn primary">
                  <i data-lucide="log-in"></i> Login
                </button>
              </div>

              <span
                id="login-error"
                class="px-help"
                style="text-align: center; display: block"
              ></span>

              <div class="px-register">
                New here? <a href="#">Ask admin to create your account</a>
              </div>
            </form>

            <!-- RIGHT CARD : FEATURES -->
            <div class="login-features">
              <div>
                <h3 class="login-features-title">Why Choose PROYAX?</h3>
                <p class="login-features-subtitle">
                  Ace your Assam CEE with our advanced mock test platform
                </p>
              </div>

              <div class="features-list">
                <div class="feature-item">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                  </svg>
                  <span
                    ><strong>Real CBT Interface</strong> â€“ Authentic
                    computer-based exam experience</span
                  >
                </div>

                <div class="feature-item">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                  </svg>
                  <span
                    ><strong>Live Timer</strong> â€“ Section-wise time tracking &
                    management</span
                  >
                </div>

                <div class="feature-item">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"
                    ></path>
                  </svg>
                  <span
                    ><strong>Secure Testing</strong> â€“ One-attempt system with
                    data protection</span
                  >
                </div>

                <div class="feature-item">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <line x1="12" y1="2" x2="12" y2="22"></line>
                    <polyline points="19 5 9 15 15 15 5 23"></polyline>
                  </svg>
                  <span
                    ><strong>Instant Results</strong> â€“ Performance analytics &
                    detailed breakdown</span
                  >
                </div>

                <div class="feature-item">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <polyline
                      points="12 3 20 7.5 20 16.5 12 21 4 16.5 4 7.5 12 3"
                    ></polyline>
                    <line x1="12" y1="12" x2="20" y2="7.5"></line>
                    <line x1="12" y1="12" x2="12" y2="21"></line>
                    <line x1="12" y1="12" x2="4" y2="7.5"></line>
                  </svg>
                  <span
                    ><strong>Comprehensive Coverage</strong> â€“ All topics from
                    Assam CEE syllabus</span
                  >
                </div>

                <!-- NEW FEATURE 1 -->
                <div class="feature-item">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M4 6h16M4 12h16M4 18h16"></path>
                  </svg>
                  <span
                    ><strong>Custom Practice</strong> â€“ Create topic-wise or
                    difficulty-wise quizzes</span
                  >
                </div>

                <!-- NEW FEATURE 2 -->
                <div class="feature-item">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12" y2="16"></line>
                  </svg>
                  <span
                    ><strong>Progress Tracking</strong> â€“ Monitor improvement
                    over time</span
                  >
                </div>

                <!-- NEW FEATURE 3 -->
                <div class="feature-item">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M20 6L9 17l-5-5"></path>
                  </svg>
                  <span
                    ><strong>Expert Solutions</strong> â€“ Step-by-step
                    explanations for every question</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- LOGIN PAGE FOOTER -->
      <footer class="login-footer">
        <div class="login-footer-inner">
          <span>Â© 2026 PROYAX Pvt Ltd Hubs. All rights reserved.</span>
          <span class="sep">â€¢</span>
          <span>Powered by <strong>PROYAX</strong></span>
          <span class="sep">â€¢</span>
          <a href="#" id="privacy-link" class="legal-link">Privacy Policy</a>
          <span class="sep">â€¢</span>
          <a href="#" id="terms-link" class="legal-link">Terms & Conditions</a>
          <span class="sep">â€¢</span>
          <span>Made in <strong>ASSAM</strong> with â¤ï¸</span>
        </div>
      </footer>
    </div>

    <!-- T&C and Privacy Policy Modal -->
    <div
      id="legal-modal"
      role="dialog"
      aria-modal="true"
      aria-labelledby="legal-title"
    >
      <div class="legal-modal-content">
        <div class="legal-modal-header">
          <h2 id="legal-title" class="legal-modal-title">Terms & Conditions</h2>
          <button
            class="legal-close-btn"
            id="legal-close"
            aria-label="Close modal"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>

        <div class="legal-modal-tabs">
          <button class="legal-modal-tab active" data-tab="terms">
            Terms & Conditions
          </button>
          <button class="legal-modal-tab" data-tab="privacy">
            Privacy Policy
          </button>
        </div>

        <div class="legal-modal-body" id="legal-modal-body">
          <!-- Content will be populated by JavaScript -->
        </div>
      </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyBOVl1hdmprJXpgdN_sNTO3FsNePD_zNZY",
        authDomain: "aahes-cee-cutoffs.firebaseapp.com",
        projectId: "aahes-cee-cutoffs",
      };
      let db = null;
      let auth = null;
      try {
        firebase.initializeApp(firebaseConfig);
        auth = firebase.auth();
        db = firebase.firestore();
      } catch (e) {
        db = null;
        auth = null;
        console.warn("firebase not configured", e);
      }

      // DOM refs
      const appEl = document.getElementById("app");
      const loginScreen = document.getElementById("login-screen");
      const loginUsername = document.getElementById("login-username");
      const loginPassword = document.getElementById("login-password");
      const loginBtn = document.getElementById("login-btn");
      const loginError = document.getElementById("login-error");
      const loadingOverlay = document.getElementById("loading-overlay");

      const qno = document.getElementById("qno");
      const questionEl = document.getElementById("question");
      const optionsEl = document.getElementById("options");
      const qtime = document.getElementById("qtime");
      const qstatus = document.getElementById("qstatus");
      const globalTimer = document.getElementById("global-timer");

      // user badge DOM refs (new)
      const userBadge = document.getElementById("user-badge");
      const userNameEl = document.getElementById("user-name");
      const userAvatarEl = document.getElementById("user-avatar");

      const openStart = document.getElementById("open-start");
      const startModal = document.getElementById("start-modal");
      const mocksContainer = document.getElementById("mocks-container");
      const closeMocks = document.getElementById("close-mocks");

      const nextBtn = document.getElementById("next-btn");
      const prevBtn = document.getElementById("prev-btn");
      const markReviewBtn = document.getElementById("mark-review");
      const submitBtn = document.getElementById("submit-btn");
      // CLEAR button ref
      const clearBtn = document.getElementById("clear-btn");

      const resultsBtn = document.getElementById("results-btn");
      const logoutBtn = document.getElementById("logout-btn");
      const fullscreenBtn = document.getElementById("fullscreen-btn");
      const sideControlsEl = document.getElementById("side-controls");
      const liveSummaryEl = document.getElementById("live-summary");

      // Legal Modal (Terms & Conditions & Privacy Policy)
      const legalModal = document.getElementById("legal-modal");
      const legalClose = document.getElementById("legal-close");
      const legalTabs = document.querySelectorAll(".legal-modal-tab");
      const legalBody = document.getElementById("legal-modal-body");
      const privacyLink = document.getElementById("privacy-link");
      const termsLink = document.getElementById("terms-link");

      const termsContent = `
        <h3>Terms and Conditions</h3>
        <p>Last updated: February 2026</p>

        <h4>1. Acceptance of Terms</h4>
        <p>By accessing and using this PROYAX Mock Test platform, you accept and agree to be bound by the terms and provision of this agreement. If you do not agree to abide by the above, please do not use this service.</p>

        <h4>2. Use License</h4>
        <p>Permission is granted to temporarily download one copy of the materials (information or software) from PROYAX for personal, non-commercial transitory viewing only. This is the grant of a license, not a transfer of title. Under this license you may not:</p>
        <ul>
          <li>Modify or copy the materials</li>
          <li>Use the materials for any commercial purpose or for any public display</li>
          <li>Attempt to decompile or reverse engineer any software contained on the platform</li>
          <li>Remove any copyright or other proprietary notations from the materials</li>
          <li>Transfer the materials to another person or "mirror" the materials on any other server</li>
          <li>Attempt to gain unauthorized access to any portion or feature of the platform</li>
          <li>Share login credentials with other users</li>
        </ul>

        <h4>3. Mock Test Rules</h4>
        <p>All mock tests on this platform are designed to simulate the actual Assam CEE examination. The following rules apply:</p>
        <ul>
          <li>Each mock test can be attempted only once per user account</li>
          <li>Test duration and number of questions are as specified before starting</li>
          <li>You cannot pause the test and resume later - once started, the timer continues</li>
          <li>Only one browser tab can be active for a test at any time</li>
          <li>Disconnection may result in auto-submission of current answers</li>
        </ul>

        <h4>4. Scoring and Results</h4>
        <p>Scores are calculated as follows:</p>
        <ul>
          <li>Each correct answer: +4 marks</li>
          <li>Each incorrect answer: -1 mark</li>
          <li>Each unanswered question: 0 marks</li>
        </ul>
        <p>Results are generated automatically upon submission and cannot be manually modified. You can view your detailed results immediately after submission.</p>

        <h4>5. Intellectual Property Rights</h4>
        <p>All content, including questions, answer keys, explanations, and visual materials on the PROYAX platform are the exclusive property of PROYAX and are protected by copyright laws. You may not reproduce, distribute, or transmit any content without prior written permission.</p>

        <h4>6. User Conduct</h4>
        <p>You agree not to:</p>
        <ul>
          <li>Use the platform for any unlawful purpose or in violation of any laws</li>
          <li>Harass, abuse, or harm any person through the platform</li>
          <li>Attempt to gain unauthorized access to the platform's systems</li>
          <li>Use automated tools, bots, or scripts to access the platform</li>
          <li>Sell, trade, or transfer access to other users</li>
        </ul>

        <h4>7. Disclaimer</h4>
        <p>The materials and content on this platform are provided on an 'as is' basis. PROYAX makes no warranties, expressed or implied, and hereby disclaims and negates all other warranties including, without limitation, implied warranties or conditions of merchantability, fitness for a particular purpose, or non-infringement of intellectual property or other violation of rights.</p>
        <p>While we strive to maintain accuracy, PROYAX does not guarantee that all content is error-free or completely representative of the actual examination.</p>

        <h4>8. Limitation of Liability</h4>
        <p>In no event shall PROYAX or its suppliers be liable for any damages (including, without limitation, damages for loss of data or profit, or due to business interruption) arising out of the use or inability to use the materials on the platform, even if PROYAX or an authorized representative has been notified of the possibility of such damage.</p>

        <h4>9. Accuracy of Materials</h4>
        <p>The materials appearing on the PROYAX platform could include technical, typographical, or photographic errors. PROYAX does not warrant that any of the materials on the platform are accurate, complete, or current. PROYAX may make changes to the materials contained on the platform at any time without notice.</p>

        <h4>10. Links</h4>
        <p>PROYAX has not reviewed all of the sites linked to its platform and is not responsible for the contents of any such linked site. The inclusion of any link does not imply endorsement by PROYAX of the site. Use of any such linked website is at the user's own risk.</p>

        <h4>11. Modifications</h4>
        <p>PROYAX may revise these terms for the platform at any time without notice. By using this platform, you are agreeing to be bound by the then current version of these terms.</p>

        <h4>12. Subscription and Billing</h4>
        <p>If your account includes a subscription plan, you agree to pay the fees associated with your subscription. Subscriptions are non-refundable. PROYAX reserves the right to modify subscription plans and pricing with 30 days' notice.</p>

        <h4>13. Governing Law</h4>
        <p>These terms and conditions are governed by and construed in accordance with the laws of Assam, India, and you irrevocably submit to the exclusive jurisdiction of the courts in that location.</p>

        <h4>14. Contact Information</h4>
        <p>If you have any questions about these Terms and Conditions, please contact us through the support section of the platform.</p>
      `;

      const privacyContent = `
        <h3>Privacy Policy</h3>
        <p>Last updated: February 2026</p>

        <h4>Introduction</h4>
        <p>PROYAX ("we", "us", "our", or "the Company") operates the PROYAX Mock Test Platform. This page informs you of our policies regarding the collection, use, and disclosure of personal data when you use our service and the choices you have associated with that data.</p>

        <h4>1. Information Collection and Use</h4>
        <p>We collect several different types of information for various purposes to provide and improve our platform.</p>

        <h5>Types of Data Collected:</h5>
        <ul>
          <li><strong>Personal Data:</strong> While using our service, we may ask you to provide us with certain personally identifiable information that can be used to contact or identify you ("Personal Data"). This may include:
            <ul>
              <li>Username and password</li>
              <li>Email address</li>
              <li>First and last name</li>
              <li>Phone number</li>
              <li>Cookies and usage data</li>
            </ul>
          </li>
          <li><strong>Academic Data:</strong> We collect information about your test attempts, responses, scores, and performance analytics to provide you with results and progress tracking.</li>
          <li><strong>Technical Data:</strong> Device information, IP address, browser type, pages visited, time and date of visit, and referring website.</li>
        </ul>

        <h4>2. Use of Data</h4>
        <p>PROYAX uses the collected data for various purposes:</p>
        <ul>
          <li>To provide and maintain the platform</li>
          <li>To notify you about changes to the platform</li>
          <li>To allow you to participate in interactive features of the platform</li>
          <li>To provide customer support</li>
          <li>To gather analysis and analytics to improve the platform</li>
          <li>To monitor the usage of the platform</li>
          <li>To detect, prevent, and address technical issues and fraudulent activity</li>
          <li>To provide you with news, special offers, and general information about our services</li>
        </ul>

        <h4>3. Security of Data</h4>
        <p>The security of your data is important to us but remember that no method of transmission over the Internet or method of electronic storage is 100% secure. While we strive to use commercially acceptable means to protect your Personal Data, we cannot guarantee its absolute security.</p>

        <h4>4. Cookies and Tracking</h4>
        <p>The platform uses cookies to enhance your experience. A cookie is a file containing an identifier (a series of letters and numbers) that is sent by a web server to a web browser and is stored by the browser. We use cookies for:</p>
        <ul>
          <li>Authentication and session management</li>
          <li>Remembering user preferences</li>
          <li>Analyzing usage patterns and improving the platform</li>
        </ul>
        <p>You can instruct your browser to refuse all cookies or to indicate when a cookie is being sent. However, if you do not accept cookies, you may not be able to use some portions of our platform.</p>

        <h4>5. Third-Party Services</h4>
        <p>Our platform integrates with Google Firebase for authentication and data storage. Firebase has its own privacy policy governing how it handles your data. We encourage you to review their privacy policy at https://www.google.com/policies/privacy/</p>

        <h4>6. Data Retention</h4>
        <p>PROYAX will retain your Personal Data and Academic Data for as long as necessary to provide our services and fulfill the purposes outlined in this privacy policy. You may request deletion of your data at any time, subject to legal and contractual obligations.</p>

        <h4>7. Your Rights</h4>
        <p>You have the right to:</p>
        <ul>
          <li>Access your personal data</li>
          <li>Correct inaccurate personal data</li>
          <li>Request deletion of your data (Right to be Forgotten)</li>
          <li>Withdraw consent for data processing</li>
          <li>Data portability</li>
        </ul>
        <p>To exercise these rights, please contact our support team through the platform.</p>

        <h4>8. Children Privacy</h4>
        <p>Our platform is not intended for individuals under 13 years of age. We do not knowingly collect personal information from children under 13. If we become aware that we have collected personal information from a child under 13, we will take steps to delete such information as quickly as possible.</p>

        <h4>9. Changes to This Privacy Policy</h4>
        <p>PROYAX may update this privacy policy from time to time. We will notify you of any changes by posting the new privacy policy on this page and updating the "Last updated" date. You are advised to review this privacy policy periodically for any changes.</p>

        <h4>10. Contact Us</h4>
        <p>If you have any questions about this Privacy Policy, please contact us:</p>
        <ul>
          <li>By email through the support section of the platform</li>
          <li>Through the contact form available in the platform</li>
        </ul>

        <h4>11. Compliance</h4>
        <p>This Privacy Policy complies with applicable data protection regulations including relevant Indian data protection laws. We are committed to protecting your privacy and ensuring you have a positive experience on our platform.</p>
      `;

      // Tab switching
      legalTabs.forEach((tab) => {
        tab.addEventListener("click", () => {
          const tabName = tab.dataset.tab;

          // Remove active class from all tabs
          legalTabs.forEach((t) => t.classList.remove("active"));

          // Add active class to clicked tab
          tab.classList.add("active");

          // Update content
          if (tabName === "terms") {
            document.getElementById("legal-title").textContent =
              "Terms & Conditions";
            legalBody.innerHTML = termsContent;
          } else if (tabName === "privacy") {
            document.getElementById("legal-title").textContent =
              "Privacy Policy";
            legalBody.innerHTML = privacyContent;
          }
        });
      });

      // Open modal from links
      privacyLink.addEventListener("click", (e) => {
        e.preventDefault();
        legalModal.style.display = "flex";
        document.getElementById("legal-title").textContent = "Privacy Policy";
        const privacyTab = document.querySelector('[data-tab="privacy"]');
        if (privacyTab) {
          legalTabs.forEach((t) => t.classList.remove("active"));
          privacyTab.classList.add("active");
          legalBody.innerHTML = privacyContent;
        }
      });

      termsLink.addEventListener("click", (e) => {
        e.preventDefault();
        legalModal.style.display = "flex";
        document.getElementById("legal-title").textContent =
          "Terms & Conditions";
        const termsTab = document.querySelector('[data-tab="terms"]');
        if (termsTab) {
          legalTabs.forEach((t) => t.classList.remove("active"));
          termsTab.classList.add("active");
          legalBody.innerHTML = termsContent;
        }
      });

      // Close modal
      legalClose.addEventListener("click", () => {
        legalModal.style.display = "none";
      });

      // Close modal when clicking outside
      legalModal.addEventListener("click", (e) => {
        if (e.target === legalModal) {
          legalModal.style.display = "none";
        }
      });

      // Fullscreen & Start-lock utilities
      function isFullscreen() {
        return !!document.fullscreenElement;
      }
      function updateStartLock() {
        if (!openStart) return;
        if (isFullscreen()) {
          openStart.classList.remove("start-locked");
          openStart.disabled = false;
          if (fullscreenBtn) fullscreenBtn.classList.add("fullscreen-active");
          var lk = openStart.querySelector(".lock-icon");
          if (lk) lk.style.display = "none";
        } else {
          openStart.classList.add("start-locked");
          openStart.disabled = true;
          if (fullscreenBtn)
            fullscreenBtn.classList.remove("fullscreen-active");
          var lk2 = openStart.querySelector(".lock-icon");
          if (lk2) lk2.style.display = "inline-block";
        }
      }

      if (fullscreenBtn) {
        fullscreenBtn.addEventListener("click", async () => {
          try {
            if (!document.fullscreenElement) {
              await document.documentElement.requestFullscreen();
            } else {
              await document.exitFullscreen();
            }
          } catch (e) {
            console.warn("fullscreen failed", e);
          }
          updateStartLock();
        });
      }

      document.addEventListener("fullscreenchange", () => {
        updateStartLock();
      });

      // initialize lock state
      setTimeout(updateStartLock, 50);

      // Live summary updater (keeps side panel counts current)
      function updateLiveSummary() {
        if (!liveSummaryEl || !questions || !responses) return;
        const subjects = {};
        questions.forEach((q, idx) => {
          const subj =
            q.subject || q.syllabus || q.section || q.topic || "General";
          if (!subjects[subj])
            subjects[subj] = { attempted: 0, marked: 0, unattempted: 0 };
          const r = responses[idx] || {};
          if (r.choiceIndex != null) subjects[subj].attempted++;
          else subjects[subj].unattempted++;
          if (r.markedReview) subjects[subj].marked++;
        });

        const map = [
          { key: "Physics", ids: ["phy-attempted", "phy-marked", "phy-un"] },
          {
            key: "Chemistry",
            ids: ["chem-attempted", "chem-marked", "chem-un"],
          },
          {
            key: "Mathematics",
            ids: ["math-attempted", "math-marked", "math-un"],
          },
        ];

        map.forEach((m) => {
          const data = subjects[m.key] || {
            attempted: 0,
            marked: 0,
            unattempted: 0,
          };
          m.ids &&
            m.ids.forEach((id, i) => {
              const el = document.getElementById(id);
              if (!el) return;
              if (i === 0) el.textContent = data.attempted;
              if (i === 1) el.textContent = data.marked;
              if (i === 2) el.textContent = data.unattempted;
            });
        });
      }

      // periodic refresh (also called by other flows if needed)
      setInterval(updateLiveSummary, 1500);

      const historyOverlay = document.getElementById("history-overlay");
      const historyGrid = document.getElementById("history-grid");
      const closeHistory = document.getElementById("close-history");

      const detailOverlay = document.getElementById("detail-overlay");
      const closeDetail = document.getElementById("close-detail");

      // Confirm modal refs
      const confirmModal = document.getElementById("confirm-submit-modal");
      const confirmAttempted = document.getElementById("confirm-attempted");
      const confirmLeft = document.getElementById("confirm-left");
      const confirmRemaining = document.getElementById("confirm-remaining");
      const confirmYes = document.getElementById("confirm-submit-yes");
      const confirmNo = document.getElementById("confirm-submit-no");

      // state
      let questions = [];
      let responses = [];
      let current = 0;
      let questionTimers = [];
      let startTime = null;
      let globalTimerInterval = null;
      let testStarted = false;
      let autoSubmitTimer = null; // kept for compatibility (not used for countdown auto-submit)
      let submittedAlready = false;
      let currentUser = null;
      let mocksList = [];
      let currentMockId = null;
      let sectionMap = null;
      let totalDurationSec = 0; // <-- total test duration in seconds (used for countdown)

      // utilities
      function fmtH(sec) {
        const h = Math.floor(sec / 3600),
          m = Math.floor((sec % 3600) / 60),
          s = sec % 60;
        return `${String(h).padStart(2, "0")}:${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;
      }
      function fmtMS(sec) {
        const m = Math.floor(sec / 60),
          s = sec % 60;
        return `${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;
      }
      function letterToIndex(letter) {
        if (letter == null) return null;
        const l = String(letter).trim().toUpperCase();
        if (l === "A") return 0;
        if (l === "B") return 1;
        if (l === "C") return 2;
        if (l === "D") return 3;
        return null;
      }

      function normalizeImgUrl(u) {
        if (!u) return null;
        const s = String(u).trim();
        if (!s) return null;
        if (/^https?:\/\//i.test(s)) return s;
        if (/^\/\//.test(s)) return location.protocol + s;
        if (s.startsWith("/")) return s;
        return "./" + s.replace(/^\.?\//, "");
      }

      function findImageFromDoc(obj) {
        if (!obj) return null;
        const keys = [
          "img",
          "image",
          "imageUrl",
          "image_url",
          "image_link",
          "imageLink",
          "img_p",
          "img_p1",
          "img1",
          "url",
          "link",
        ];
        for (const k of keys) {
          if (
            Object.prototype.hasOwnProperty.call(obj, k) &&
            obj[k] != null &&
            String(obj[k]).trim() !== ""
          )
            return normalizeImgUrl(obj[k]);
        }
        for (const k of Object.keys(obj)) {
          if (/img/i.test(k) || /image/i.test(k)) {
            const v = obj[k];
            if (v && String(v).trim() !== "") return normalizeImgUrl(v);
          }
        }
        return null;
      }

      function sampleBank() {
        const secs = ["Physics", "Chemistry", "Mathematics"];
        const out = [];
        secs.forEach((sec) => {
          for (let i = 1; i <= 20; i++) {
            out.push({
              id: sec[0] + i,
              section: sec,
              text: `Sample ${sec} question ${i}`,
              options: ["A", "B", "C", "D"],
              answerIndex: Math.floor(Math.random() * 4),
              img: null,
            });
          }
        });
        return out;
      }

      function escapeHtml(str) {
        if (!str) return "";
        return String(str).replace(/[&<>"']/g, function (m) {
          return {
            "&": "&amp;",
            "<": "&lt;",
            ">": "&gt;",
            '"': "&quot;",
            "'": "&#39;",
          }[m];
        });
      }

      // new helper: format Date (date-only). Handles Firestore Timestamp and ISO/string fallback
      function formatDateOnly(field) {
        if (!field) return "-";
        try {
          // Firestore Timestamp object
          if (field.toDate && typeof field.toDate === "function") {
            const d = field.toDate();
            return d.toLocaleDateString();
          }
          // ISO string or Date-like
          const dt = new Date(field);
          if (!isNaN(dt.getTime())) return dt.toLocaleDateString();
          // fallback to raw string trimmed (show only date part if includes T)
          const s = String(field);
          if (s.indexOf("T") > 0) return s.split("T")[0];
          return s;
        } catch (e) {
          return String(field);
        }
      }

      function findSyllabusFromDoc(m) {
        // Try several common fields
        if (!m) return "";
        return m.syllabus || m.syl || m.desc || m.description || m.notes || "";
      }

      // UI init
      appEl.setAttribute("aria-hidden", "true");
      loginScreen.style.display = "flex";
      // ensure badge hidden by default
      userBadge.style.display = "none";
      userNameEl.textContent = "Not signed in";
      userAvatarEl.textContent = "P";
      globalTimer.textContent = "00:00:00";

      // login (no guest/demo option)
      document
        .getElementById("login-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          loginError.textContent = "";

          const email = (loginUsername.value || "").trim();
          const p = loginPassword.value || "";

          if (!email || !p) {
            loginError.textContent = "enter credentials";
            return;
          }

          if (!auth) {
            loginError.textContent = "auth not configured";
            return;
          }

          loginError.textContent = "checking...";
          loadingOverlay.style.display = "flex";

          try {
            // attempt sign in via Firebase Authentication
            const userCredential = await auth.signInWithEmailAndPassword(
              email,
              p,
            );
            const user = userCredential.user;

            // fetch extra profile data from Firestore if available
            let data = {};
            if (db) {
              // first try document keyed by uid
              const docSnap = await db.collection("users").doc(user.uid).get();
              if (docSnap.exists) {
                data = docSnap.data();
              } else {
                // fallback to querying by email field
                const snap = await db
                  .collection("users")
                  .where("email", "==", email)
                  .limit(1)
                  .get();
                if (!snap.empty) {
                  data = snap.docs[0].data();
                }
              }
            }

            // âœ… set current user with subscription
            currentUser = {
              username: data.username || email,
              name: data.name || email,
              subscription: (data.subscription || "").toLowerCase(),
            };

            // âœ… apply logo / branding based on subscription
            applySubscriptionBranding(currentUser.subscription);

            onLoggedIn();
          } catch (e) {
            console.error(e);
            loginError.textContent = e.message || "login failed";
          } finally {
            loadingOverlay.style.display = "none";
          }
        });

      function onLoggedIn() {
        // show attractive badge
        userNameEl.textContent =
          currentUser.name || currentUser.username || "User";
        userAvatarEl.textContent =
          currentUser.name && currentUser.name[0]
            ? currentUser.name[0].toUpperCase()
            : currentUser.username
              ? currentUser.username[0].toUpperCase()
              : "U";
        userBadge.style.display = "flex";

        // hide login, show app controls
        loginScreen.style.display = "none";
        appEl.setAttribute("aria-hidden", "false");
        resultsBtn.style.display = "inline-block";
        openStart.style.display = "inline-block";
        logoutBtn.style.display = "inline-block";
        loadMocks();
      }

      logoutBtn.addEventListener("click", () => {
        if (
          testStarted &&
          !submittedAlready &&
          !confirm("Discard running test?")
        )
          return;
        // sign out from Firebase auth if available
        if (auth) {
          auth.signOut().catch(() => {});
        }
        currentUser = null;
        applySubscriptionBranding(null);
        userBadge.style.display = "none";
        userNameEl.textContent = "Not signed in";
        userAvatarEl.textContent = "P";
        openStart.style.display = "inline-block";
        resultsBtn.style.display = "none";
        openStart.style.display = "none";
        logoutBtn.style.display = "none";
        testStarted = false;
        // Hide status dot on logout
        const statusDot = document.getElementById("status-dot");
        if (statusDot) statusDot.style.display = "none";
        submittedAlready = false;
        if (autoSubmitTimer) clearTimeout(autoSubmitTimer);
        stopGlobalTimer();
        totalDurationSec = 0;
        globalTimer.textContent = "00:00:00";
        questions = sampleBank();
        responses = questions.map(() => ({
          choiceIndex: null,
          marked: false,
          timeUsed: 0,
          viewed: false,
        }));
        questionTimers = questions.map(() => null);
        current = 0;
        renderQuestion();
        renderPicker("Physics");
        loginScreen.style.display = "flex";
        appEl.setAttribute("aria-hidden", "true");
        currentMockId = null;
      });

      /* ========== mocks ========== */
      async function hasAttempted(mockId) {
        if (!db || !currentUser) return false;
        try {
          const snap = await db
            .collection("res")
            .where("username", "==", currentUser.username)
            .where("mockId", "==", mockId)
            .limit(1)
            .get();
          return !snap.empty;
        } catch (e) {
          console.warn("hasAttempted failed", e);
          return false;
        }
      }

      async function loadMocks() {
        mocksContainer.innerHTML = `<div style="padding:8px;color:${getComputedStyle(document.documentElement).getPropertyValue("--muted") || "#666"}">Loading...</div>`;
        if (!db) {
          mocksList = [
            {
              id: "local-1",
              name: "Mock 1",
              time: "120",
              qns: "60",
              syllabus: "Full CEE",
              active: "yes",
              date: new Date().toISOString(),
              img_p1: "https://via.placeholder.com/600x360?text=P1",
              ans_p1: "A",
              img_c1: "https://via.placeholder.com/600x360?text=C1",
              ans_c1: "B",
              img_m1: "https://via.placeholder.com/600x360?text=M1",
              ans_m1: "C",
            },
            {
              id: "local-2",
              name: "Mock 2 (Archived)",
              time: "90",
              qns: "30",
              syllabus: "Physics only",
              active: "no",
              date: null,
            },
          ];
          await renderMocks();
          return;
        }
        try {
          const snap = await db.collection("mocks").orderBy("name").get();

          const userSub = (currentUser?.subscription || "").toLowerCase();

          mocksList = snap.docs
            .map((d) => Object.assign({ id: d.id }, d.data()))
            .filter((m) => {
              const mockSub = (m.subscription || "").toLowerCase();
              return mockSub === userSub;
            });
        } catch (e) {
          console.warn(e);
          mocksList = [
            {
              id: "err",
              name: "No mocks",
              syllabus: "See console",
              active: "no",
            },
          ];
        }
        await renderMocks();
      }

      async function renderMocks() {
        mocksContainer.innerHTML = "";
        for (const m of mocksList) {
          const isActive =
            typeof m.active === "string"
              ? m.active.toLowerCase() === "yes" ||
                m.active.toLowerCase() === "true"
              : !!m.active;
          let attempted = false;
          if (currentUser && db) {
            try {
              attempted = await hasAttempted(m.id);
            } catch (e) {
              attempted = false;
            }
          }

          const card = document.createElement("div");
          card.className =
            "mock-card" + (!isActive || attempted ? " inactive" : "");

          // compute display values
          const durationText = m.duration || m.time || "-";
          const qCountText = m.questionCount || m.qns || "-";
          // syllabus: check common fields (syl, syllabus, desc)
          const syllabusText = escapeHtml(findSyllabusFromDoc(m));
          // date-only formatting helper (handles Firestore Timestamp)
          const dateText = m.date ? escapeHtml(formatDateOnly(m.date)) : "-";

          // Show name, duration & qns, then add date (date only) and syllabus on the card
          card.innerHTML = `
          <div style="font-weight:800">${escapeHtml(m.name || m.id)}</div>
          <div style="font-size:12px;color:${getComputedStyle(document.documentElement).getPropertyValue("--muted") || "#666"}">
            ${durationText} min â€¢ ${qCountText} Qs
          </div>
          <div style="font-size:12px;margin-top:6px;color:#222"><strong>Date:</strong> ${dateText}</div>
          <div style="font-size:12px;margin-top:6px;color:#222"><strong>Syllabus:</strong> ${syllabusText || "-"}</div>
        `;

          const btn = document.createElement("button");
          btn.style.marginTop = "8px";

          if (!isActive) {
            btn.className = "btn-secondary";
            btn.textContent = "Not available";
            btn.disabled = true;
          } else if (attempted) {
            btn.className = "btn-secondary";
            btn.textContent = "Attempted";
            btn.disabled = true;
          } else {
            btn.className = "btn-primary";
            btn.textContent = "Start";
            btn.addEventListener("click", () => {
              startModal.style.display = "none";
              startMock(m);
            });
          }

          card.appendChild(btn);

          if (m.active !== undefined || attempted) {
            const lbl = document.createElement("div");
            lbl.style.fontSize = "11px";
            lbl.style.fontWeight = "800";
            lbl.style.marginTop = "6px";
            if (attempted) {
              lbl.style.color = "#b37b4a";
              lbl.textContent = "Attempted";
            } else lbl.style.color = isActive ? "#0b9a6b" : "#b37b4a";
            if (!attempted) lbl.textContent = isActive ? "Active" : "Inactive";
            card.appendChild(lbl);
          }

          mocksContainer.appendChild(card);
        }
      }

      closeMocks.addEventListener("click", () => {
        startModal.style.display = "none";
      });

      /* ========== start mock ========== */
      async function startMock(mock) {
        if (!mock) return;

        const isActive =
          typeof mock.active === "string"
            ? mock.active.toLowerCase() === "true" ||
              mock.active.toLowerCase() === "yes"
            : !!mock.active;

        if (!isActive) {
          alert("This mock is not available.");
          return;
        }

        if (currentUser && db) {
          const already = await hasAttempted(mock.id);
          if (already) {
            alert("You have already attempted this mock.");
            await loadMocks();
            return;
          }
        }

        let built = [];

        if (db) {
          try {
            const snap = await db
              .collection("mocks")
              .doc(mock.id)
              .collection("questions")
              .orderBy("index")
              .get();

            if (!snap.empty) {
              built = snap.docs.map((d, i) => {
                const q = d.data();
                return {
                  id: d.id,
                  section: q.section,
                  text: q.text || null,
                  img: q.img || q.image || q.imageUrl || null,
                  options: ["A", "B", "C", "D"],
                  answerIndex: letterToIndex(q.ans || q.answer || q.correct),
                };
              });
            }
          } catch (e) {
            console.warn("Subcollection fetch failed", e);
          }
        }

        /* ======================================================
               ðŸ”¥ 2ï¸âƒ£ NEW: SUPPORT SUBJECT-WISE QUESTIONS OBJECT
               (THIS MATCHES YOUR SCREENSHOT EXACTLY)
            ====================================================== */
        if (
          !built.length &&
          mock.questions &&
          typeof mock.questions === "object"
        ) {
          const subjects = ["Physics", "Chemistry", "Mathematics"];

          subjects.forEach((subject) => {
            const arr = mock.questions[subject];
            if (Array.isArray(arr)) {
              arr.forEach((q, i) => {
                built.push({
                  id: `${subject[0]}${i + 1}`,
                  section: subject,
                  text: null,
                  img: q.img || null,
                  options: ["A", "B", "C", "D"],
                  answerIndex: letterToIndex(q.ans),
                });
              });
            }
          });
        }

        /* ======================================================
               3ï¸âƒ£ OLD FALLBACK (UNCHANGED)
            ====================================================== */
        if (!built.length) {
          built = sampleBank();
        }

        /* ======================================================
               FINAL NORMALIZATION (UNCHANGED)
            ====================================================== */
        questions = built.map((q, i) => ({
          id: q.id || `Q${i + 1}`,
          section: q.section,
          text: q.text,
          img: normalizeImgUrl(q.img),
          options: q.options || ["A", "B", "C", "D"],
          answerIndex: q.answerIndex,
        }));

        // build section map (UNCHANGED)
        sectionMap = {};
        questions.forEach((q, i) => {
          if (!sectionMap[q.section]) sectionMap[q.section] = [];
          sectionMap[q.section].push(i);
        });

        responses = questions.map(() => ({
          choiceIndex: null,
          markedReview: false,
          timeSpentSec: 0,
          viewed: false,
        }));

        questionTimers = questions.map(() => null);
        current = 0;

        const durationMin = Number(mock.duration) || 120;
        totalDurationSec = durationMin * 60;

        startTime = Date.now();
        testStarted = true;
        submittedAlready = false;
        // Show status dot during test
        const statusDot = document.getElementById("status-dot");
        if (statusDot) statusDot.style.display = "inline-block";
        // hide results while a mock is running
        try {
          if (resultsBtn) resultsBtn.style.display = "none";
        } catch (e) {}

        startGlobalTimer();
        const firstSection = updateSectionTabs();
        if (firstSection) {
          setActiveSection(firstSection);
        }

        currentMockId = mock.id;
        openStart.style.display = "none";
      }

      /* ========== render / timers ========== */
      function startGlobalTimer() {
        if (globalTimerInterval) clearInterval(globalTimerInterval);
        // immediately update display
        function updateOnce() {
          if (
            !startTime ||
            typeof totalDurationSec !== "number" ||
            totalDurationSec <= 0
          ) {
            globalTimer.textContent = "00:00:00";
            return;
          }
          const elapsed = Math.floor((Date.now() - startTime) / 1000);
          let remaining = totalDurationSec - elapsed;
          if (remaining < 0) remaining = 0;
          globalTimer.textContent = fmtH(remaining);
          if (remaining <= 0) {
            // stop timer, auto submit
            clearInterval(globalTimerInterval);
            globalTimerInterval = null;
            // ensure we only auto-submit once
            if (!submittedAlready) {
              submitTest(true).catch(() => {
                /* ignore */
              });
            }
          }
        }
        updateOnce();
        globalTimerInterval = setInterval(updateOnce, 500);
      }
      function stopGlobalTimer() {
        if (globalTimerInterval) {
          clearInterval(globalTimerInterval);
          globalTimerInterval = null;
        }
      }

      // Helper functions that now use sectionMap
      function getSectionOfIndex(idx) {
        return questions[idx] && questions[idx].section
          ? questions[idx].section
          : null;
      }

      function getNumberWithinSection(idx) {
        const sec = getSectionOfIndex(idx);
        if (!sec || !sectionMap || !sectionMap[sec]) return null;
        return sectionMap[sec].indexOf(idx) + 1; // 1-based
      }

      function getGlobalIndex(section, num) {
        if (!sectionMap || !sectionMap[section]) return null;
        if (num - 1 < 0 || num - 1 >= sectionMap[section].length) return null;
        return sectionMap[section][num - 1];
      }

      function firstIndexOfSection(section) {
        if (
          !sectionMap ||
          !sectionMap[section] ||
          sectionMap[section].length === 0
        )
          return 0;
        return sectionMap[section][0];
      }

      function applySubscriptionBranding(subscription) {
        const sub = (subscription || "").toLowerCase();

        let src = "favicon.png";
        if (sub === "prx") src = "favicon.png";
        else if (sub === "civinity") src = "favicon.png";

        document.getElementById("app-banner").src = src;
        document.getElementById("login-banner").src = src;
      }

      function renderQuestion() {
        // If test not started -> show rules block (same content as initial HTML)
        if (!testStarted) {
          const rulesHTML = `
          <div class="rules">
            <h3>Rules</h3>
            <ul>
              <li>+4 for a correct answer</li>
              <li>-1 for a wrong answer</li>
              <li>0 for unanswered questions</li>
              <li>Only one attempt allowed per mock â€” reattempts are not permitted</li>
              <li>Use <strong>Mark</strong> to flag questions for review and submit when done</li>
            </ul>

            <h3 style="margin-top:10px">Dashboard â€” quick guide</h3>
            <ul>
              <li>Timer (top-right): shows elapsed time for your current attempt.</li>
              <li>Question palette (right): jump to any question in the section; colored badges show answered/marked status.</li>
              <li>Controls (bottom): <strong>Prev/Next</strong> to navigate, <strong>Mark</strong> to flag, and <strong>Submit</strong> to finish.</li>
              <li>Results: after submission you can view per-question outcome, time used and summary analytics in the "Results" window.</li>
            </ul>

            <div class="muted">When you're ready, click <strong>Start</strong> to begin the mock. Good luck!</div>
          </div>
        `;
          questionEl.innerHTML = rulesHTML;
          optionsEl.innerHTML = "";
          qno.textContent = "Question 1";
          qtime.textContent = "Time spent: 00:00";
          qstatus.textContent = "Status: Unseen";
          return;
        }

        // mark current as viewed when rendering it
        if (responses[current]) responses[current].viewed = true;

        const q = questions[current];
        qno.textContent = `${q.section} â€¢ Q ${getNumberWithinSection(current) || 1}`;

        optionsEl.innerHTML = "";
        questionEl.innerHTML = "";

        if (q.img) {
          const im = document.createElement("img");
          im.src = q.img;
          im.alt = q.id || "question image";
          im.onerror = function () {
            console.warn("Image load failed for", q.img);
            this.onerror = null;
            this.src =
              "data:image/svg+xml;utf8," +
              encodeURIComponent(
                `<svg xmlns="http://www.w3.org/2000/svg" width="600" height="360"><rect width="100%" height="100%" fill="#fff4ed"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#b37b4a" font-family="Arial" font-size="20">Image failed to load</text></svg>`,
              );
          };
          questionEl.appendChild(im);
        } else if (q.text) {
          const p = document.createElement("div");
          p.textContent = q.text;
          p.style.color = "#0f172a";
          questionEl.appendChild(p);
        } else {
          const p = document.createElement("div");
          p.textContent = "No image available for this question";
          p.style.color = "#b37b4a";
          questionEl.appendChild(p);
        }

        qtime.textContent =
          "Time spent: " + fmtMS(responses[current].timeSpentSec || 0);
        const resp = responses[current];
        qstatus.textContent = resp.markedReview
          ? "Status: Marked"
          : resp.choiceIndex === null
            ? "Status: Unseen"
            : "Status: Answered";

        const opts = ["A", "B", "C", "D"];
        opts.forEach((lab, i) => {
          const d = document.createElement("div");
          d.className = "opt" + (resp.choiceIndex === i ? " selected" : "");
          d.textContent = lab;
          d.addEventListener("click", () => {
            recordQuestionTimeStop(current);
            responses[current].choiceIndex = i;
            responses[current].markedReview = false;
            renderQuestion();
            renderPicker(getSectionOfIndex(current));
            recordQuestionTimeStart(current);
          });
          optionsEl.appendChild(d);
        });

        questionTimers[current] = questionTimers[current] || Date.now();
      }

      function renderPicker(section) {
        const picker = document.getElementById("section-picker");
        picker.innerHTML = "";
        const list =
          sectionMap && sectionMap[section] ? sectionMap[section] : [];
        for (let i = 0; i < list.length; i++) {
          const idx = list[i];
          if (idx === undefined) continue;
          const st = responses[idx] || {
            choiceIndex: null,
            markedReview: false,
            viewed: false,
          };
          // priority: marked -> answered -> viewed -> default
          let cls = "qbtn";
          if (st.markedReview) cls += " review";
          else if (st.choiceIndex !== null) cls += " answered";
          else if (st.viewed) cls += " viewed";

          const el = document.createElement("div");
          el.className = cls;
          el.textContent = i + 1;
          el.title = `Q ${i + 1}`;
          el.addEventListener("click", () => {
            // stop time for previous
            if (testStarted) recordQuestionTimeStop(current);
            // set current and mark viewed immediately so UI shows ribbon even before renderQuestion sets it
            current = idx;
            if (responses[current]) responses[current].viewed = true;
            renderQuestion();
            renderPicker(section);
            // resume timer
            if (testStarted) recordQuestionTimeStart(current);
          });
          picker.appendChild(el);
        }
      }

      function firstIndexOfSection(section) {
        if (
          !sectionMap ||
          !sectionMap[section] ||
          sectionMap[section].length === 0
        )
          return 0;
        return sectionMap[section][0];
      }

      document
        .getElementById("btn-phy")
        .addEventListener("click", () => setActiveSection("Physics"));
      document
        .getElementById("btn-chem")
        .addEventListener("click", () => setActiveSection("Chemistry"));
      document
        .getElementById("btn-math")
        .addEventListener("click", () => setActiveSection("Mathematics"));

      function setActiveSection(section) {
        document
          .getElementById("btn-phy")
          .classList.toggle("active", section === "Physics");
        document
          .getElementById("btn-chem")
          .classList.toggle("active", section === "Chemistry");
        document
          .getElementById("btn-math")
          .classList.toggle("active", section === "Mathematics");

        if (typeof recordQuestionTimeStop === "function" && testStarted) {
          recordQuestionTimeStop(current);
        }

        const idx = firstIndexOfSection(section);
        if (typeof idx === "number" && idx >= 0 && idx < questions.length) {
          current = idx;
        }

        // mark viewed when switching into section (we render question which sets viewed)
        renderQuestion();
        renderPicker(section);
      }

      nextBtn.addEventListener("click", () => {
        if (!testStarted) return;
        recordQuestionTimeStop(current);
        current = Math.min(questions.length - 1, current + 1);
        renderQuestion();
        renderPicker(getSectionOfIndex(current));
      });
      prevBtn.addEventListener("click", () => {
        if (!testStarted) return;
        recordQuestionTimeStop(current);
        current = Math.max(0, current - 1);
        renderQuestion();
        renderPicker(getSectionOfIndex(current));
      });
      markReviewBtn.addEventListener("click", () => {
        if (!testStarted) return;
        responses[current].markedReview = !responses[current].markedReview;
        renderQuestion();
        renderPicker(getSectionOfIndex(current));
      });

      // CLEAR button behaviour: deselect current option and remove mark
      clearBtn.addEventListener("click", () => {
        if (!testStarted) return;
        // stop current timer (we keep time already spent)
        recordQuestionTimeStop(current);
        // clear selection and unmark
        responses[current].choiceIndex = null;
        responses[current].markedReview = false;
        // update UI
        renderQuestion();
        renderPicker(getSectionOfIndex(current));
        // resume timing for this question
        recordQuestionTimeStart(current);
      });

      function recordQuestionTimeStart(idx) {
        if (!questionTimers[idx]) questionTimers[idx] = Date.now();
      }
      function recordQuestionTimeStop(idx) {
        if (questionTimers[idx]) {
          const delta = Math.floor((Date.now() - questionTimers[idx]) / 1000);
          responses[idx].timeSpentSec =
            (responses[idx].timeSpentSec || 0) + delta;
          questionTimers[idx] = null;
          qtime.textContent =
            "Time spent: " + fmtMS(responses[idx].timeSpentSec || 0);
        }
      }

      // Updated Submit behavior: show confirmation modal with stats
      submitBtn.addEventListener("click", (e) => {
        e.preventDefault();
        if (!testStarted || submittedAlready) return;
        showSubmitConfirm();
      });

      function showSubmitConfirm() {
        if (!testStarted || submittedAlready) return;
        const attempted = responses.filter(
          (r) => r.choiceIndex !== null,
        ).length;
        const left = responses.length - attempted;
        let remaining = 0;
        if (startTime && typeof totalDurationSec === "number") {
          const elapsed = Math.floor((Date.now() - startTime) / 1000);
          remaining = Math.max(0, totalDurationSec - elapsed);
        }
        confirmAttempted.textContent = `Attempted: ${attempted}`;
        confirmLeft.textContent = `Left: ${left}`;
        confirmRemaining.textContent = `Time left: ${fmtH(remaining)}`;
        confirmModal.style.display = "flex";
      }

      confirmNo.addEventListener("click", () => {
        confirmModal.style.display = "none";
      });
      // Confirm yes -> proceed to submit. If there are marked questions, warn first in modal flow.
      confirmYes.addEventListener("click", async () => {
        confirmModal.style.display = "none";
        if (!testStarted || submittedAlready) return;
        // if there are any marked questions, confirm again (small inline check)
        const marked = responses
          .map((r, i) => (r.markedReview ? i : -1))
          .filter((x) => x >= 0);
        if (marked.length) {
          if (!confirm(`You have ${marked.length} marked. Submit anyway?`))
            return;
        }
        await submitTest();
      });

      async function submitTest(isAuto = false) {
        if (!testStarted || submittedAlready) return;
        submittedAlready = true;
        questionTimers.forEach((t, i) => {
          if (t) recordQuestionTimeStop(i);
        });
        stopGlobalTimer();
        totalDurationSec = 0;
        globalTimer.textContent = "00:00:00";
        const { total, per } = computeScore();

        const result = {
          username: currentUser ? currentUser.username : "anon",
          name: currentUser ? currentUser.name : "anon",
          mockId: currentMockId || null,
          score: total,
          date:
            firebase && firebase.firestore
              ? firebase.firestore.FieldValue.serverTimestamp()
              : new Date().toISOString(),
          durationSec: Math.floor((Date.now() - startTime) / 1000),
          autoSubmitted: !!isAuto,
          perQuestion: questions.map((q, i) => ({
            qid: q.id,
            qidNormalized: (q.qid || q.id || "").toString(),
            section: q.section,
            imageUrl: q.img || q.imageUrl || q.imgUrl || null,
            selectedIndex: responses[i].choiceIndex,
            correctIndex: q.answerIndex,
            score: per[i],
            timeUsedSec: responses[i].timeSpentSec,
            markedReview: responses[i].markedReview,
          })),
        };

        if (db) {
          try {
            await db.collection("res").add(result);
          } catch (e) {
            console.warn("save failed", e);
          }
        } else {
          console.log("would save", result);
        }

        responses = questions.map(() => ({
          choiceIndex: null,
          markedReview: false,
          timeSpentSec: 0,
          viewed: false,
        }));
        questionTimers = questions.map(() => null);
        current = 0;
        submittedAlready = false;
        testStarted = false;
        // Hide status dot after test submission
        const statusDot = document.getElementById("status-dot");
        if (statusDot) statusDot.style.display = "none";
        startTime = null;
        if (autoSubmitTimer) clearTimeout(autoSubmitTimer);
        renderQuestion();
        renderPicker(getSectionOfIndex(current));

        openStart.style.display = "inline-block";
        currentMockId = null;

        if (currentUser) await loadMocks();

        // after submit, show results button again
        try {
          if (resultsBtn)
            resultsBtn.style.display = currentUser ? "inline-block" : "none";
        } catch (e) {}

        alert("Submitted. Results saved.");
      }

      function computeScore() {
        const per = responses.map((r, i) => {
          if (r.choiceIndex === null) return 0;
          const corr = questions[i].answerIndex;
          if (corr === null || corr === undefined) return 0;
          return r.choiceIndex === corr ? 4 : -1;
        });
        const total = per.reduce((a, b) => a + b, 0);
        return { total, per };
      }

      /* ========== history & details ========== */
      resultsBtn.addEventListener("click", async () => {
        historyOverlay.style.display = "flex";
        historyGrid.innerHTML = "";
        if (!db) {
          historyGrid.innerHTML =
            '<div style="padding:8px">DB not configured</div>';
          return;
        }
        if (!currentUser) {
          historyGrid.innerHTML =
            '<div style="padding:8px">Login to view</div>';
          return;
        }
        try {
          let snap = await db
            .collection("res")
            .where("username", "==", currentUser.username)
            .orderBy("date", "desc")
            .limit(100)
            .get()
            .catch(async () => {
              const alt = await db
                .collection("res")
                .orderBy("date", "desc")
                .limit(200)
                .get();
              return {
                docs: alt.docs.filter(
                  (d) => d.data().username === currentUser.username,
                ),
              };
            });
          if (!snap || snap.docs.length === 0) {
            historyGrid.innerHTML =
              '<div style="padding:8px">No submissions</div>';
            return;
          }
          snap.docs.forEach((doc) => {
            const d = doc.data();
            const card = document.createElement("div");
            card.className = "history-card";
            card.innerHTML = `<div style="font-weight:800">${d.name || d.username}</div><div style="font-size:12px;color:${getComputedStyle(document.documentElement).getPropertyValue("--muted")}">${d.score} â€¢ ${d.perQuestion ? d.perQuestion.length : "-"} Qs</div>`;
            const v = document.createElement("button");
            v.className = "btn-secondary";
            v.textContent = "View";
            v.style.marginTop = "6px";
            v.addEventListener("click", async () => {
              const docf = await db.collection("res").doc(doc.id).get();
              showDetailFromDoc(docf);
              // Close history overlay when detail overlay is opened
              historyOverlay.style.display = "none";
            });
            card.appendChild(v);
            historyGrid.appendChild(card);
          });
        } catch (e) {
          console.error(e);
          historyGrid.innerHTML =
            '<div style="padding:8px">Failed to load</div>';
        }
      });
      closeHistory.addEventListener(
        "click",
        () => (historyOverlay.style.display = "none"),
      );

      // robust showDetailFromDoc â€” checks saved image first, then runtime questions[], then Firestore fallback
      async function showDetailFromDoc(doc) {
        // doc may be a firestore doc snapshot or a plain object
        const d = doc && doc.data ? doc.data() : doc || {};
        document.getElementById("detail-title").textContent =
          `Submission â€” ${d.name || d.username || "User"}`;
        const savedText = d.date
          ? d.date.toDate
            ? d.date.toDate().toLocaleString()
            : d.date
          : "-";
        document.getElementById("detail-sub").textContent =
          `Saved: ${savedText}`;

        const scoreBadge = document.getElementById("detail-score");
        if (scoreBadge) {
          const big = scoreBadge.querySelector(".big");
          if (big) big.textContent = d.score || 0;
        }

        const perQ = d.perQuestion || [];
        const totalQs = perQ.length;
        const maxScore = totalQs * 4;
        document.getElementById("right-total").textContent = d.score || 0;
        document.getElementById("right-max").textContent = maxScore;
        document.getElementById("right-duration").textContent = (() => {
          if (d.durationSec) {
            const m = Math.floor(d.durationSec / 60),
              s = d.durationSec % 60;
            return `${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;
          }
          return "-";
        })();

        // Compute overall correct/wrong/unanswered and subject-wise marks
        let correct = 0,
          wrong = 0,
          unanswered = 0;
        const subj = {}; // subj -> { correct, wrong, unanswered, positive, negative }
        perQ.forEach((pq) => {
          const section = pq.section || "Unknown";
          if (!subj[section])
            subj[section] = {
              correct: 0,
              wrong: 0,
              unanswered: 0,
              positive: 0,
              negative: 0,
              net: 0,
            };
          if (pq.selectedIndex == null) {
            unanswered++;
            subj[section].unanswered++;
          } else if (
            pq.correctIndex != null &&
            pq.selectedIndex === pq.correctIndex
          ) {
            correct++;
            subj[section].correct++;
            subj[section].positive += 4;
          } else {
            wrong++;
            subj[section].wrong++;
            subj[section].negative += 1;
          }
        });

        // compute net for each subject and overall
        let overallPositive = 0,
          overallNegative = 0;
        Object.keys(subj).forEach((k) => {
          subj[k].net = subj[k].positive - subj[k].negative;
          overallPositive += subj[k].positive;
          overallNegative += subj[k].negative;
        });

        document.getElementById("stat-correct").textContent = correct;
        document.getElementById("stat-wrong").textContent = wrong;
        document.getElementById("stat-unanswered").textContent = unanswered;

        // Update the progress bar as before
        const percent = totalQs
          ? Math.round(((correct + wrong) / totalQs) * 100)
          : 0;
        const pb = document.getElementById("progress-bar");
        if (pb) pb.style.width = `${percent}%`;

        // Remove old breakdown if present
        let existingBreakdown = document.getElementById("subject-breakdown");
        if (existingBreakdown) existingBreakdown.remove();

        const leftCol = document.querySelector(".detail-left");
        if (leftCol) {
          const breakdown = document.createElement("div");
          breakdown.id = "subject-breakdown";
          breakdown.style.display = "flex";
          breakdown.style.gap = "8px";
          breakdown.style.flexWrap = "wrap";
          breakdown.style.marginTop = "10px";
          breakdown.style.alignItems = "center";

          // overall summary
          const overallDiv = document.createElement("div");
          overallDiv.className = "stat";
          overallDiv.style.minWidth = "160px";
          overallDiv.innerHTML = `<strong style="font-size:16px">${overallPositive - overallNegative || 0}</strong><span style="font-size:12px;color:${getComputedStyle(document.documentElement).getPropertyValue("--muted")}">Overall (net)</span>
        <div style="margin-top:6px;font-size:12px;color:${getComputedStyle(document.documentElement).getPropertyValue("--muted")}">+${overallPositive} / -${overallNegative}</div>`;
          breakdown.appendChild(overallDiv);

          // per-subject cards (Physics, Chemistry, Mathematics kept in same order if present)
          const prefer = ["Physics", "Chemistry", "Mathematics"];
          const keys = [
            ...prefer.filter((k) => subj[k]),
            ...Object.keys(subj).filter((k) => !prefer.includes(k)),
          ];

          keys.forEach((k) => {
            const s = subj[k];
            const card = document.createElement("div");
            card.className = "stat";
            card.style.minWidth = "140px";
            card.innerHTML = `<strong style="font-size:15px">${s.net}</strong><span style="font-size:12px;color:${getComputedStyle(document.documentElement).getPropertyValue("--muted")}">${escapeHtml(k)}</span>
            <div style="margin-top:6px;font-size:12px;color:${getComputedStyle(document.documentElement).getPropertyValue("--muted")}">+${s.positive} / -${s.negative}</div>`;
            breakdown.appendChild(card);
          });

          // insert the breakdown after the stats-row element
          const statsRow = leftCol.querySelector(".stats-row");
          if (statsRow && statsRow.parentNode) {
            statsRow.parentNode.insertBefore(breakdown, statsRow.nextSibling);
          } else {
            leftCol.insertBefore(breakdown, leftCol.firstChild);
          }
        }

        // Build per-question list and attach Preview (eye) button
        const list = document.getElementById("perq-list");
        list.innerHTML = "";
        (d.perQuestion || []).forEach((pq, i) => {
          const tr = document.createElement("div");
          tr.className = "perq-item";
          const left = document.createElement("div");
          left.className = "perq-left";
          left.textContent = i + 1;

          const mid = document.createElement("div");
          mid.className = "perq-mid";
          const qid = document.createElement("div");
          qid.className = "qid";
          qid.textContent = pq.qid || "";

          const selText =
            pq.selectedIndex == null
              ? "-"
              : String.fromCharCode(65 + pq.selectedIndex);
          const corText =
            pq.correctIndex == null
              ? "-"
              : String.fromCharCode(65 + pq.correctIndex);

          const selSpan = document.createElement("div");
          selSpan.textContent = `Selected: ${selText}`;

          const corSpan = document.createElement("div");
          corSpan.textContent = `Correct: ${corText}`;

          const timeSpan = document.createElement("div");
          timeSpan.textContent = `Time: ${typeof pq.timeUsedSec === "number" ? Math.floor(pq.timeUsedSec / 60) + ":" + String(pq.timeUsedSec % 60).padStart(2, "0") : "-"}`;

          const scoreSpan = document.createElement("div");
          scoreSpan.textContent = `Score: ${pq.score || 0}`;

          // preview button (eye SVG)
          const viewBtn = document.createElement("button");
          viewBtn.className = "btn secondary";
          viewBtn.style.marginLeft = "8px";
          viewBtn.title = "View question image";
          viewBtn.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" style="vertical-align:middle" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg> View
        `;
          // on click: try to find image and open preview window
          viewBtn.addEventListener("click", async () => {
            const qidVal = pq.qid || pq.qidNormalized || "";
            // 1) check image embedded in the saved attempt (best)
            let imgUrl = pq.imageUrl || pq.img || pq.image || null;

            // 2) fallback: try to find it in current runtime questions[]
            if (!imgUrl && Array.isArray(questions) && questions.length) {
              try {
                const found = questions.find(
                  (q) =>
                    String(q.id) === String(qidVal) ||
                    String(q.qid || "") === String(qidVal),
                );
                if (found)
                  imgUrl = found.img || found.imageUrl || found.imgUrl || null;
              } catch (e) {}
            }

            // 3) fallback: try to fetch question doc from Firestore (if mockId available)
            if (!imgUrl && db && d.mockId) {
              try {
                const qSnap = await db
                  .collection("mocks")
                  .doc(d.mockId)
                  .collection("questions")
                  .where("qid", "==", qidVal)
                  .limit(1)
                  .get()
                  .catch(() => ({ docs: [] }));
                if (qSnap && qSnap.docs && qSnap.docs.length) {
                  const qdoc = qSnap.docs[0].data();
                  imgUrl =
                    qdoc.imageUrl ||
                    qdoc.img ||
                    qdoc.image ||
                    findImageFromDoc(qdoc) ||
                    null;
                }
              } catch (e) {
                console.warn("failed to fetch question doc for preview", e);
              }
            }

            // show preview (open window)
            const w = window.open("", "_blank", "width=900,height=700");
            if (!w) {
              alert("Popup blocked â€” allow popups to preview images");
              return;
            }
            if (imgUrl) {
              w.document.title = "Question Preview - " + qidVal;
              w.document.body.style.margin = "0";
              w.document.body.innerHTML = `<div style="display:flex;align-items:center;justify-content:center;height:100vh;background:#fff;padding:12px"><img src="${escapeHtml(imgUrl)}" style="max-width:100%;max-height:100%;object-fit:contain" alt="${escapeHtml(qidVal)}" /></div>`;
            } else {
              w.document.title = "Preview - Not available";
              w.document.body.style.margin = "0";
              w.document.body.innerHTML = `<div style="display:flex;align-items:center;justify-content:center;height:100vh;background:#fff;padding:12px;color:#b37b4a;font-weight:800">No image available for ${escapeHtml(qidVal)}</div>`;
            }
          });

          const badge = document.createElement("div");
          badge.className = "badge";
          if (pq.selectedIndex == null) {
            badge.classList.add("unseen");
            badge.textContent = "Unanswered";
          } else if (pq.selectedIndex === pq.correctIndex) {
            badge.classList.add("correct");
            badge.textContent = "Correct";
          } else {
            badge.classList.add("wrong");
            badge.textContent = "Wrong";
          }

          mid.appendChild(qid);
          mid.appendChild(selSpan);
          mid.appendChild(corSpan);
          mid.appendChild(scoreSpan);
          mid.appendChild(timeSpan);

          tr.appendChild(left);
          tr.appendChild(mid);

          // actions column: badge + view button
          const actionsWrap = document.createElement("div");
          actionsWrap.style.display = "flex";
          actionsWrap.style.gap = "8px";
          actionsWrap.style.alignItems = "center";
          actionsWrap.appendChild(badge);
          actionsWrap.appendChild(viewBtn);

          tr.appendChild(actionsWrap);
          list.appendChild(tr);
        });

        // show the modal
        detailOverlay.style.display = "flex";
        const closeTop = document.getElementById("close-detail");
        if (closeTop)
          closeTop.onclick = () => {
            detailOverlay.style.display = "none";
          };
        const closeBottom = document.getElementById("close-detail-bottom");
        if (closeBottom)
          closeBottom.onclick = () => {
            detailOverlay.style.display = "none";
          };
      }

      closeDetail.addEventListener(
        "click",
        () => (detailOverlay.style.display = "none"),
      );

      /* ========== init ========== */
      // initial fallback sample
      questions = sampleBank();
      // Build an initial sectionMap from sampleBank
      (function buildInitialSectionMap() {
        const map = {};
        for (let i = 0; i < questions.length; i++) {
          const s = questions[i].section || "Unknown";
          if (!map[s]) map[s] = [];
          map[s].push(i);
        }
        const preferred = ["Physics", "Chemistry", "Mathematics"];
        const ordered = {};
        preferred.forEach((p) => {
          if (map[p]) ordered[p] = map[p];
        });
        Object.keys(map).forEach((k) => {
          if (!ordered[k]) ordered[k] = map[k];
        });
        sectionMap = ordered;
      })();

      responses = questions.map(() => ({
        choiceIndex: null,
        markedReview: false,
        timeSpentSec: 0,
        viewed: false,
      }));
      questionTimers = questions.map(() => null);
      current = 0;
      renderQuestion();
      renderPicker("Physics");

      openStart.addEventListener("click", () => {
        if (!currentUser) {
          loginError.textContent = "Please login";
          loginScreen.style.display = "flex";
          loginUsername.focus();
          return;
        }
        // require fullscreen to start
        if (!document.fullscreenElement) {
          // indicate fullscreen is required
          if (fullscreenBtn) {
            fullscreenBtn.classList.add("fullscreen-active");
            try {
              fullscreenBtn.animate(
                [
                  { transform: "scale(1)" },
                  { transform: "scale(1.04)" },
                  { transform: "scale(1)" },
                ],
                { duration: 360 },
              );
            } catch (e) {}
          }
          // pulse/lock the start button
          openStart.classList.add("start-locked");
          try {
            openStart.animate(
              [
                { transform: "translateX(0)" },
                { transform: "translateX(-6px)" },
                { transform: "translateX(6px)" },
                { transform: "translateX(0)" },
              ],
              { duration: 420 },
            );
          } catch (e) {}
          return;
        }
        startModal.style.display = "flex";
      });

      (async () => {
        if (db) await loadMocks();
        else {
          mocksList = [
            {
              id: "local-1",
              name: "Mock 1",
              time: "120",
              qns: "60",
              syllabus: "Full CEE",
              active: "yes",
              img_p1: "https://via.placeholder.com/600x360?text=P1",
              ans_p1: "A",
              img_c1: "https://via.placeholder.com/600x360?text=C1",
              ans_c1: "B",
              img_m1: "https://via.placeholder.com/600x360?text=M1",
              ans_m1: "C",
            },
            {
              id: "local-2",
              name: "Mock 2 (Archived)",
              time: "90",
              qns: "30",
              syllabus: "Physics only",
              active: "no",
            },
          ];
          await renderMocks();
        }
      })();

      // auto-focus username when login shows
      // If you programmatically show login screen elsewhere, call: loginUsername.focus()

      function updateSectionTabs() {
        const phyBtn = document.getElementById("btn-phy");
        const chemBtn = document.getElementById("btn-chem");
        const mathBtn = document.getElementById("btn-math");

        const hasPhysics =
          sectionMap && sectionMap.Physics && sectionMap.Physics.length;
        const hasChem =
          sectionMap && sectionMap.Chemistry && sectionMap.Chemistry.length;
        const hasMath =
          sectionMap && sectionMap.Mathematics && sectionMap.Mathematics.length;

        phyBtn.style.display = hasPhysics ? "inline-block" : "none";
        chemBtn.style.display = hasChem ? "inline-block" : "none";
        mathBtn.style.display = hasMath ? "inline-block" : "none";

        // return first available section (priority order)
        if (hasPhysics) return "Physics";
        if (hasChem) return "Chemistry";
        if (hasMath) return "Mathematics";
        return null;
      }

      applySubscriptionBranding(null);

      document.addEventListener("dragstart", (e) => {
        if (e.target.tagName === "IMG") e.preventDefault();
      });

      document.addEventListener("contextmenu", (e) => {
        if (e.target.tagName === "IMG") e.preventDefault();
      });

      document.addEventListener("mousedown", (e) => {
        if (e.target.tagName === "IMG") e.preventDefault();
      });
    </script>
    <script>
      lucide.createIcons();
    </script>
  </body>
</html>
